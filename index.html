<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>thekeelan.co.uk</title>
<style>
  :root{
    --bg:#0f1014; --panel:#171922; --panel2:#1b1e28;
    --row:#1a1c25; --row2:#171922; --line:#262a38;
    --text:#e7e8ec; --muted:#9aa0a6; --sub:#cfd2da;
    --pill:#2b2f3a; --accent:#c22d2d;
    --win:#2bbf6a; --draw:#e3b341; --loss:#ff5d5d;
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;background:var(--bg);color:var(--text);
    font:14px/1.45 system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Ubuntu,"Helvetica Neue",Arial,"Noto Sans","Apple Color Emoji","Segoe UI Emoji";}
  a{color:inherit;text-decoration:none}
  .wrap{max-width:1400px;margin:24px auto;padding:0 16px;
    display:grid;grid-template-columns:220px 1fr 440px;grid-gap:18px;}
  .card{background:var(--panel);border-radius:14px;box-shadow:0 8px 20px rgba(0,0,0,.35), inset 0 0 0 1px rgba(255,255,255,.03);overflow:hidden}
  .pad{padding:14px 16px}
  .title{display:flex;align-items:center;gap:8px;font-weight:700;letter-spacing:.2px}
  .dot{width:8px;height:8px;border-radius:50%;background:var(--accent);display:inline-block}

  /* left */
  .gifbox img{width:100%;display:block;border-radius:12px}

  /* table */
  .table{display:grid;grid-template-rows:auto 1fr;min-height:420px}
  .tbl-head,.tbl-row{display:grid;grid-template-columns:40px 1fr repeat(6,56px);
    column-gap:12px;align-items:center;padding:10px 14px}
  .tbl-head{position:sticky;top:0;background:linear-gradient(var(--panel),var(--panel));
    border-bottom:1px solid var(--line);font-weight:600;color:var(--sub)}
  .tbl-body{max-height:520px;overflow:auto}
  .tbl-row{border-bottom:1px solid rgba(255,255,255,.04);background:var(--row)}
  .tbl-row:nth-child(even){background:var(--row2)}
  .num{text-align:center;font-variant-numeric:tabular-nums}
  .club{display:flex;align-items:center;gap:10px}
  .club img{width:18px;height:18px;object-fit:contain;filter:drop-shadow(0 1px 1px #0008)}

  /* fixtures/results */
  .section h3{margin:0 0 6px 0;font-size:15px;color:var(--sub)}
  .fx-list{display:flex;flex-direction:column;gap:10px}
  .fx{display:grid;grid-template-columns:52px 1fr auto;gap:10px;align-items:center;
    padding:10px 12px;border-radius:10px;background:var(--panel2);border:1px solid rgba(255,255,255,.04)}
  .date{color:var(--muted);text-align:center;line-height:1.25}
  .date .dow{font-weight:700;color:var(--sub)}
  .match{display:flex;align-items:center;gap:10px}
  .side{display:flex;align-items:center;gap:8px;min-width:120px}
  .side img{width:18px;height:18px;object-fit:contain}
  .pill{padding:4px 8px;border-radius:999px;font-size:12px;letter-spacing:.3px;background:var(--pill);color:#cfd2da;text-transform:uppercase;font-weight:700}
  .score{font-weight:800}
  .win{color:var(--win)} .draw{color:var(--draw)} .loss{color:var(--loss)}
  .muted{color:var(--muted)} .sp{opacity:.6}

  /* right col stack */
  .rightcol{display:flex;flex-direction:column;gap:18px}

  /* R6 iframe */
  .r6frame{width:100%;height:420px;border:0;border-radius:12px;background:#0a0b0e}

  @media (max-width:1100px){ .wrap{grid-template-columns:1fr} }
</style>
</head>
<body>
<div class="wrap">

  <!-- LEFT -->
  <div class="card pad gifbox">
    <img src="https://media4.giphy.com/media/v1.Y2lkPTc5MGI3NjExNWZpb3poZnFpdWpxeWlybHRsb3M1aTVzeGNjMHFldWR1Nm9jczlpMCZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/8fxad4tvqIzwk/giphy.gif" alt="gif">
  </div>

  <!-- MIDDLE: Table -->
  <div class="card table">
    <div class="pad title"><span class="dot"></span> Premier League Table</div>
    <div class="tbl-head">
      <div class="num">#</div><div>Club</div>
      <div class="num">P</div><div class="num">W</div><div class="num">D</div><div class="num">L</div><div class="num">GD</div><div class="num">Pts</div>
    </div>
    <div id="tableBody" class="tbl-body"><div class="pad muted">Loading table…</div></div>
  </div>

  <!-- RIGHT: Fixtures + R6 -->
  <div class="rightcol">
    <div class="card pad section">
      <div class="title"><span class="dot"></span> Man United — Fixtures & Results</div>
      <h3>Upcoming</h3>
      <div id="upcoming" class="fx-list"><div class="muted">Loading…</div></div>
      <h3 style="margin-top:10px">Recent Results</h3>
      <div id="recent" class="fx-list"><div class="muted">Loading…</div></div>
    </div>

    <div class="card pad">
      <div class="title"><span class="dot"></span> R6 Tracker — BambyOnSpice</div>
      <iframe class="r6frame"
        src="https://tracker.gg/r6siege/profile/ubi/BambyOnSpice/overview?playlist=ranked"
        loading="lazy"></iframe>
      <div class="muted" id="r6fallback" style="padding:10px 4px;display:none">
        Couldn’t embed R6 stats. <a class="pill" href="https://tracker.gg/r6siege/profile/ubi/BambyOnSpice/overview" target="_blank" rel="noopener">Open profile ↗</a>
      </div>
      <script>
        setTimeout(()=>{ try{
          const f=document.querySelector('.r6frame');
          if(!f || f.contentDocument==null){ document.getElementById('r6fallback').style.display='block'; }
        }catch(_){ document.getElementById('r6fallback').style.display='block'; }}, 2500);
      </script>
    </div>
  </div>

</div>

<script>
/* ---------------- constants ---------------- */
const TEAM_ID = 360; // MUFC
const ESPN_SCHEDULE = `https://site.api.espn.com/apis/site/v2/sports/soccer/eng.1/teams/${TEAM_ID}/schedule`;
const ESPN_TABLE    = "https://site.api.espn.com/apis/site/v2/sports/soccer/eng.1/standings";
const now = new Date();
const seasonStart = now.getMonth()<7 ? now.getFullYear()-1 : now.getFullYear();
const TSDB_TABLE   = `https://www.thesportsdb.com/api/v1/json/3/lookuptable.php?l=4328&s=${seasonStart}-${seasonStart+1}`;
const el = s => document.querySelector(s);

/* ---------------- utils ---------------- */
const safeNum = v => { const n = Number(v); return Number.isFinite(n) ? n : null; };
const fmtDay = d => new Date(d).toLocaleDateString("en-GB",{weekday:"short"});
const fmtDate = d => new Date(d).toLocaleDateString("en-GB",{day:"2-digit",month:"short"});
const fmtTime = d => new Date(d).toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"});
const side = t => ({ name: t?.displayName || t?.name || "", logo: t?.logo || t?.logos?.[0]?.href || "" });

/* ---------------- fixtures ---------------- */
function classify(isHome, hs, as){
  if(hs==null || as==null) return "";
  const us = isHome ? hs : as, them = isHome ? as : hs;
  if(us>them) return "win";
  if(us<them) return "loss";
  return "draw";
}

function buildFixture(ev){
  const comp = ev?.competitions?.[0] || {};
  const leagueName = (comp?.name || ev?.league?.name || "").toLowerCase();
  if(!leagueName.includes("premier league")) return null;

  const when = ev?.date || comp?.date;
  const home = (comp?.competitors||[]).find(t=>t.homeAway==="home");
  const away = (comp?.competitors||[]).find(t=>t.homeAway==="away");
  if(!home || !away) return null;

  let hs = safeNum(home?.score), as = safeNum(away?.score);
  const statusType = comp?.status?.type || ev?.status?.type || {};
  const completed = !!statusType.completed; // trust ESPN flag

  const h=side(home.team), a=side(away.team);
  const isHomeMU = (h.name||"").toLowerCase().startsWith("manchester united");

  let center = "";
  if(completed){
    const label = (hs!=null && as!=null) ? `${hs}–${as}` : "—";
    center = `<span class="score ${classify(isHomeMU,hs,as)}">${label}</span>`;
  }else{
    center = `<span class="pill">UPCOMING</span>`;
  }

  return {
    dateKey: new Date(when).getTime(),
    dateText: `${fmtDay(when)}<br><span class="muted">${fmtDate(when)} ${fmtTime(when)}</span>`,
    left:`<div class="side"><img src="${h.logo}" alt=""><span>${h.name}</span></div>`,
    right:`<div class="side"><img src="${a.logo}" alt=""><span>${a.name}</span></div>`,
    center, isUpcoming: !completed
  };
}

function renderFixtures(list, into){
  into.innerHTML = list.map(f=>`
    <div class="fx">
      <div class="date"><div class="dow">${f.dateText}</div></div>
      <div class="match">${f.left}<span class="sp">vs</span>${f.right}</div>
      <div>${f.center}</div>
    </div>
  `).join("") || `<div class="muted">No items.</div>`;
}

async function loadFixtures(){
  // 1) Try local compiled assets
  try{
    const r0 = await fetch("assets/fixtures.json",{cache:"no-store"});
    if(r0.ok){
      const json = await r0.json();
      if(Array.isArray(json) && json.length){
        const up  = json.filter(x=> (x.status||"").toUpperCase()!=="FT").slice(0,8);
        const res = json.filter(x=> (x.status||"").toUpperCase()==="FT").slice(-8).reverse();
        renderFixtures(up.map(j=>({
          dateKey:Date.parse(`${j.date}T${(j.time||"00:00")}:00Z`),
          dateText:`${fmtDay(j.date)}<br><span class="muted">${j.date} ${j.time||"TBC"}</span>`,
          left:`<div class="side"><img src="${j.homeBadge||""}" alt=""><span>${j.home}</span></div>`,
          right:`<div class="side"><img src="${j.awayBadge||""}" alt=""><span>${j.away}</span></div>`,
          center:`<span class="pill">${(j.status||"UPCOMING")}</span>`,
          isUpcoming:true
        })), el("#upcoming"));
        renderFixtures(res.map(j=>{
          const parts=(j.score||"").split("–"); const hs=safeNum(parts[0]); const as=safeNum(parts[1]);
          const isHomeMU=(j.home||"").toLowerCase().startsWith("manchester united");
          return {
            dateKey:Date.parse(`${j.date}T${(j.time||"00:00")}:00Z`),
            dateText:`${fmtDay(j.date)}<br><span class="muted">${j.date} ${j.time||""}</span>`,
            left:`<div class="side"><img src="${j.homeBadge||""}" alt=""><span>${j.home}</span></div>`,
            right:`<div class="side"><img src="${j.awayBadge||""}" alt=""><span>${j.away}</span></div>`,
            center:`<span class="score ${classify(isHomeMU,hs,as)}">${j.score||"—"}</span>`,
            isUpcoming:false
          };
        }), el("#recent"));
        return;
      }
    }
  }catch(_){}

  // 2) Fallback to live ESPN
  try{
    const r = await fetch(ESPN_SCHEDULE,{cache:"no-store"});
    const data = await r.json();
    const events = [...(data.events||[]), ...(data.nextEvents||[])];
    const items = [];
    for(const ev of events){ const f=buildFixture(ev); if(f) items.push(f); }
    items.sort((a,b)=>a.dateKey-b.dateKey);

    const upcoming = items.filter(x=>x.isUpcoming).slice(0,8);
    const recent   = items.filter(x=>!x.isUpcoming).slice(-8).reverse();

    renderFixtures(upcoming, el("#upcoming"));
    renderFixtures(recent,   el("#recent"));
  }catch(e){
    console.error("fixtures error", e);
    el("#upcoming").innerHTML = `<div class="muted">Couldn’t load fixtures.</div>`;
    el("#recent").innerHTML   = `<div class="muted">Couldn’t load results.</div>`;
  }
}

/* ---------------- table ---------------- */
function ESPNtoRows(data){
  let entries=null;
  (function dive(x){
    if(entries) return;
    if(Array.isArray(x)){ x.forEach(dive); return; }
    if(x && typeof x==="object"){
      if(x.standings && Array.isArray(x.standings.entries)){ entries = x.standings.entries; return; }
      Object.values(x).forEach(dive);
    }
  })(data);
  if(!entries) return [];
  return entries.map((e,i)=>{
    const t=e.team||{};
    const name=t.displayName||t.name||"";
    const logo=t.logo||t.logos?.[0]?.href||"";
    const s=e.stats||[];
    const val=n=>{const it=s.find(z=>z.name===n); const v=it?.value ?? it?.displayValue;
      const n2=Number(v); return Number.isFinite(n2)?n2:null;};
    const played=val("gamesPlayed")??0, win=val("wins")??0, draw=val("ties")??0, loss=val("losses")??0;
    const gf=(val("goalsFor")??val("pointsFor")??0), ga=(val("goalsAgainst")??val("pointsAgainst")??0);
    const gd=(gf||0)-(ga||0), pts=val("points")??0;
    return {rank:i+1,name,logo,played,win,draw,loss,gd,pts};
  }).filter(r=>r.name).slice(0,20);
}
function TSDBtoRows(data){
  const arr = data?.table || [];
  return arr.map(x=>({
    rank:Number(x.intRank),
    name:x.strTeam || x.name || "",
    logo:x.strTeamBadge || "",
    played:Number(x.intPlayed||0),
    win:Number(x.intWin||0),
    draw:Number(x.intDraw||0),
    loss:Number(x.intLoss||0),
    gd:Number(x.intGoalDifference||0),
    pts:Number(x.intPoints||0)
  })).filter(r=>r.name).sort((a,b)=>a.rank-b.rank);
}
function renderTable(rows){
  const body = el("#tableBody");
  if(!rows.length){ body.innerHTML = `<div class="pad muted">No table data available right now.</div>`; return;}
  body.innerHTML = rows.map(r=>`
    <div class="tbl-row">
      <div class="num">${r.rank}</div>
      <div class="club"><img src="${r.logo||""}" alt=""><span>${r.name}</span></div>
      <div class="num">${r.played}</div>
      <div class="num">${r.win}</div>
      <div class="num">${r.draw}</div>
      <div class="num">${r.loss}</div>
      <div class="num">${r.gd}</div>
      <div class="num">${r.pts}</div>
    </div>`).join("");
}
async function loadTable(){
  // 1) local artifact
  try{
    const r0 = await fetch("assets/table.json",{cache:"no-store"});
    if(r0.ok){
      const j = await r0.json();
      if(Array.isArray(j) && j.length){ renderTable(j); return; }
    }
  }catch(_){}
  // 2) ESPN live
  try{
    const r = await fetch(ESPN_TABLE,{cache:"no-store"});
    const d = await r.json();
    let rows = ESPNtoRows(d);
    if(!rows.length){
      const rr = await fetch(TSDB_TABLE,{cache:"no-store"});
      const td = await rr.json();
      rows = TSDBtoRows(td);
    }
    renderTable(rows);
  }catch(e){
    console.error("table error", e);
    el("#tableBody").innerHTML = `<div class="pad muted">No table data available right now.</div>`;
  }
}

/* ---------------- init ---------------- */
(async function(){
  await Promise.all([loadFixtures(), loadTable()]);
})();
</script>
</body>
</html>
