<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>thekeelan.co.uk</title>
<link rel="icon" type="image/svg+xml" href="/assets/favicon.svg">
<meta name="theme-color" content="#0b0f14">
<style>
:root{--text:#e9eef5;--muted:#9aa6b2;--card:#12161b;--border:#1e242c;--accent:#6ee7ff;--hdr:72px}
*{box-sizing:border-box}
body{margin:0;color:var(--text);font:14px/1.55 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial;
  background:linear-gradient(180deg,rgba(0,0,0,.60),rgba(0,0,0,.80)),url('https://images.unsplash.com/photo-1517927033932-b3d18e61fb3a?auto=format&fit=crop&w=2400&q=60') center top/cover no-repeat fixed;background-color:#0b0f14}
header{position:sticky;top:0;z-index:10;display:flex;gap:12px;align-items:center;padding:10px 18px;border-bottom:1px solid var(--border);backdrop-filter:blur(8px);background:rgba(11,15,20,.6)}
.brand{display:flex;gap:10px;align-items:center}
.brand-logo{width:28px;height:28px;border-radius:6px;background:
  radial-gradient(circle at 30% 30%,#6ee7ff,transparent 40%),
  radial-gradient(circle at 70% 70%,#a78bfa,transparent 40%);box-shadow:0 0 0 1px #2a3340 inset}
.spacer{flex:1}
#lastUpdated{color:var(--muted);white-space:nowrap}
nav a{margin-left:8px;padding:8px 12px;border:1px solid var(--border);border-radius:999px;color:var(--muted);text-decoration:none}
nav a:hover{color:var(--text);background:#0f141a;border-color:#2a3340}

.grid{display:grid;grid-template-columns:1fr 1.6fr 1.2fr;gap:18px;padding:12px 18px 24px}
@media (max-width:1200px){.grid{grid-template-columns:1fr 1fr}}
@media (max-width:980px){.grid{grid-template-columns:1fr}}
.card{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:14px;box-shadow:0 6px 24px rgba(0,0,0,.35)}
.card h2{margin:0 0 8px}
.panel{border:1px solid var(--border);border-radius:10px;overflow:auto}
.left-img{border:1px solid var(--border);border-radius:10px;overflow:hidden}
.left-img img{display:block;width:100%;height:auto}

/* table */
table{width:100%;border-collapse:collapse}
th,td{padding:8px 10px;border-bottom:1px solid var(--border);text-align:center}
thead th{position:sticky;top:0;background:#0f141a}
.team-cell{display:flex;gap:8px;align-items:center;justify-content:flex-start}
.badge{width:20px;height:20px;border-radius:50%;background:#0f141a;display:inline-flex;align-items:center;justify-content:center;font-weight:700;font-size:11px}
.badge.img{background:none}
.badge.initials{border:1px solid #243041;color:#b6c2cf;text-transform:uppercase}

/* results banding */
tr.W td{background:rgba(6,50,22,.8)}
tr.D td{background:rgba(50,50,10,.6)}
tr.L td{background:rgba(60,20,20,.7)}

a.btn{display:inline-block;padding:2px 8px;border:1px solid var(--border);border-radius:8px;font-size:12px;text-decoration:none;color:var(--text)}
</style>
</head>
<body>
<header id="siteHeader">
  <div class="brand"><div class="brand-logo"></div><strong>thekeelan.co.uk</strong></div>
  <div class="spacer"></div>
  <div id="lastUpdated">Last updated: —</div>
  <nav><a href="/" aria-current="page">Football</a><a href="/extras.html">Extras</a></nav>
</header>

<div class="grid">
  <!-- Left -->
  <section class="card">
    <h2>Left Panel</h2>
    <div class="left-img">
      <img src="https://media3.giphy.com/media/v1.Y2lkPTc5MGI3NjExcThlOWlqcmc5YnZmcTVtaDByZHdpZHd4cWo4YTl0NXB4NGlxNnFlaSZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/yRl0DstAx4nN0RjDLV/giphy.gif" alt="">
    </div>
  </section>

  <!-- Centre -->
  <section class="card" id="tableCard">
    <h2>Premier League Table</h2>
    <div class="panel">
      <table>
        <thead><tr><th>#</th><th style="text-align:left">Team</th><th>P</th><th>W</th><th>D</th><th>L</th><th>GF</th><th>GA</th><th>GD</th><th>Pts</th></tr></thead>
        <tbody id="tableBody"><tr><td colspan="10" style="color:#9aa6b2">No or partial table data. Check /assets/table.json.</td></tr></tbody>
      </table>
    </div>
  </section>

  <!-- Right -->
  <section class="card">
    <h2>Man United – Fixtures & Results</h2>
    <div id="fixturesWrap" class="panel" style="padding:8px"><div style="color:#9aa6b2">Waiting for data…</div></div>
  </section>
</div>

<script>
const bust = `?t=${Date.now()}`;
const urls = (p)=>[`/assets/${p}`,`assets/${p}`,`./assets/${p}`];
async function getJSON(p){
  for(const u of urls(p)){ try{ const r=await fetch(u+bust,{cache:'no-store'}); if(r.ok) return r.json(); }catch{} }
  return null;
}
async function getText(p){
  for(const u of urls(p)){ try{ const r=await fetch(u+bust,{cache:'no-store'}); if(r.ok) return r.text(); }catch{} }
  return "";
}
const norm = s=>(s||"").toLowerCase().replace(/&/g,"and").replace(/[^a-z0-9]/g,"");
const initials = t=>t.split(/\s+/).filter(Boolean).map(w=>w[0]).slice(0,2).join('').toUpperCase();
const https = u=>(u||"").replace(/^http:\/\//,"https://");

// ------------- TABLE + BADGES -------------
(async ()=>{
  const [table,badges] = await Promise.all([getJSON('table.json'), getJSON('badges.json')]);
  const tbody = document.getElementById('tableBody');
  const lu = document.getElementById('lastUpdated');

  if(lu){
    const s = await getText('update_stamp.txt');
    lu.textContent = 'Last updated: ' + (s?.trim() || new Date(table?.updated||Date.now()).toLocaleString());
  }

  if(!table?.standings?.length){ return; }

  const bmap = Object.fromEntries(Object.entries(badges?.badges||{}).map(([k,v])=>[k, https(v)]));
  const rows = table.standings;
  tbody.innerHTML = rows.map(r=>{
    const img = bmap[norm(r.team)];
    const badge = img ? `<img class="badge img" referrerpolicy="no-referrer" src="${img}" alt="">`
                      : `<span class="badge initials" data-team="${r.team}">${initials(r.team||'')}</span>`;
    return `<tr>
      <td>${r.pos}</td>
      <td style="text-align:left"><span class="team-cell">${badge}${r.team}</span></td>
      <td>${r.played}</td><td>${r.won}</td><td>${r.drawn}</td><td>${r.lost}</td>
      <td>${r.gf}</td><td>${r.ga}</td><td>${r.gd}</td><td><strong>${r.pts}</strong></td>
    </tr>`;
  }).join('');
})();

// ------------- FIXTURES -------------
(async ()=>{
  const fx = await getJSON('fixtures.json');
  const wrap = document.getElementById('fixturesWrap');
  if(!fx?.matches?.length){ wrap.innerHTML = '<div style="color:#9aa6b2">No fixtures data.</div>'; return; }

  const t = s=>new Date(s).getTime()||0;
  const finished = m=>{
    const st=(m.status||'').toUpperCase();
    if(st==='FINISHED') return true;
    if(st==='SCHEDULED') return false;
    if(m.score && Number.isFinite(m.score.home) && Number.isFinite(m.score.away)) return true;
    return t(m.date) < Date.now();
  };
  const all = fx.matches.slice().sort((a,b)=>t(a.date)-t(b.date));
  const up  = all.filter(m=>!finished(m)).slice(0,8);
  const rec = all.filter(finished).sort((a,b)=>t(b.date)-t(a.date)).slice(0,8);
  const fmtD = d=>new Date(d).toLocaleDateString('en-GB',{day:'2-digit',month:'short',year:'numeric',timeZone:'Europe/London'});
  const fmtT = d=>new Date(d).toLocaleTimeString('en-GB',{hour:'2-digit',minute:'2-digit',hour12:false,timeZone:'Europe/London'});

  const guessTV=(date,comp)=>{
    const dt=new Date(date); const day=dt.toLocaleString('en-GB',{weekday:'short',timeZone:'Europe/London'});
    const hm =dt.toLocaleTimeString('en-GB',{hour:'2-digit',minute:'2-digit',hour12:false,timeZone:'Europe/London'});
    if(!/premier/i.test(comp||"")) return '';
    if(day==='Sat'&&hm==='12:30') return 'TNT';
    if(day==='Sat'&&(hm==='17:30'||hm==='20:00')) return 'Sky';
    if(day==='Sun'&&(hm==='14:00'||hm==='16:30'||hm==='19:00')) return 'Sky';
    if((day==='Mon'||day==='Fri')&&(hm==='19:45'||hm==='20:00')) return 'Sky';
    return '';
  };

  const upHTML = `
    <h3 style="margin:8px 0">Upcoming</h3>
    <table><thead><tr><th>Date (UK)</th><th>Time</th><th>Comp</th><th>Home</th><th></th><th>Away</th><th>TV</th></tr></thead>
    <tbody>
      ${up.map(m=>`<tr>
        <td>${fmtD(m.date)}</td><td>${fmtT(m.date)}</td><td>${m.comp||''}</td>
        <td>${m.home}</td><td>vs</td><td>${m.away}</td>
        <td>${(m.tv||'').replace(/;|,/g,', ') || guessTV(m.date,m.comp)}</td>
      </tr>`).join('')}
    </tbody></table>`;

  const rowCls=oc=>oc==='W'?'W':(oc==='D'?'D':(oc==='L'?'L':''));
  const recHTML = `
    <h3 style="margin:12px 0 6px">Recent Results</h3>
    <table>
      <thead><tr><th>Date</th><th>Comp</th><th>Home</th><th></th><th>Away</th><th>Score</th><th>Highlights</th></tr></thead>
      <tbody>
        ${rec.map(m=>{
          const sc = m.score ? `${m.score.home}–${m.score.away}` : '';
          const oc = m.score?.outcome || '';
          const y = new Date(m.date).getFullYear();
          const q = encodeURIComponent(`${m.home} ${m.away} highlights ${y}`);
          const sky = `https://www.skysports.com/search?q=${q}`;
          const yt  = `https://www.youtube.com/results?search_query=${q}`;
          return `<tr class="${rowCls(oc)}">
            <td>${fmtD(m.date)}</td><td>${m.comp||''}</td>
            <td>${m.home}</td><td>vs</td><td>${m.away}</td>
            <td><strong>${sc}</strong>${oc?` (${oc})`:''}</td>
            <td><a class="btn" href="${sky}" target="_blank" rel="noopener">Sky</a>
                <a class="btn" href="${yt}"  target="_blank" rel="noopener" style="margin-left:6px">YT</a></td>
          </tr>`;
        }).join('')}
      </tbody>
    </table>`;

  wrap.innerHTML = upHTML + recHTML;
})();
</script>
</body>
</html>
