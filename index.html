<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>thekeelan.co.uk — Football</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><circle cx=%2250%22 cy=%2250%22 r=%2245%22 fill=%22%2300d4ff%22/></svg>">
  <style>
    :root{
      --bg:#0c1117; --panel:#121823; --muted:#95a2b3; --text:#e6edf3; --accent:#00d4ff;
      --row:#0f1520; --border:#0f2237; --card-radius:16px; --gap:18px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; background:radial-gradient(1200px 600px at 70% -10%, #0d2238 0%, #0c1117 60%);
      color:var(--text); font:14px/1.45 system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
    }
    header{
      display:flex; justify-content:space-between; align-items:center;
      padding:14px 18px; color:var(--muted);
    }
    header .nav a{
      display:inline-block; margin-left:8px; padding:6px 12px; border-radius:999px;
      background:#0b1422; color:#cde3ff; text-decoration:none;
      border:1px solid #0e2139; transition:all .15s;
    }
    header .nav a.active{background:#0a7cc0; border-color:#0a7cc0; color:#fff}

    /* WIDE layout: 3 columns on desktop */
    .wrap{
      max-width:1400px; margin:0 auto; padding:0 18px 28px;
      display:grid; grid-template-columns: 1fr 1.2fr 1fr; gap:var(--gap);
    }
    @media (max-width:1100px){
      .wrap{ grid-template-columns:1fr; }
    }

    .card{
      background:var(--panel); border:1px solid var(--border); border-radius:var(--card-radius);
      box-shadow:0 0 0 1px rgba(255,255,255,.02) inset;
      overflow:hidden;
    }
    .card h2{
      margin:0; padding:14px 16px; font-size:16px; font-weight:700; letter-spacing:.2px;
      border-bottom:1px solid var(--border); display:flex; justify-content:space-between; align-items:center;
      background:linear-gradient(180deg, rgba(255,255,255,.02), transparent);
    }
    .panel-body{ padding:12px 14px; overflow:visible }

    /* Left GIF */
    .gif{ width:100%; aspect-ratio:16/9; object-fit:cover; display:block; }

    /* Table */
    table{width:100%; border-collapse:collapse; font-size:14px}
    thead th{
      text-align:left; color:var(--muted); font-weight:600; padding:10px 8px; position:sticky; top:0;
      background:var(--panel); z-index:1; border-bottom:1px solid var(--border);
    }
    tbody td{ padding:10px 8px; border-bottom:1px solid var(--border); }
    tbody tr:nth-child(odd){ background:var(--row) }
    .num{ text-align:center; width:28px; color:#a8b6c6 }
    .tight{ width:26px; text-align:center }
    .team{
      display:flex; align-items:center; gap:10px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
    }
    .badge{
      width:18px; height:18px; border-radius:999px; background:#0a2540; display:inline-grid; place-items:center; font-size:11px; color:#cde3ff;
      flex:0 0 18px;
    }
    .pill{font-size:12px; color:#9fb3c8; background:#0b1422; border:1px solid #0e2139; padding:4px 8px; border-radius:999px}

    .fixture-table td,.fixture-table th{ padding:8px 10px }
  </style>
</head>
<body>
  <header>
    <div>thekeelan.co.uk</div>
    <div class="nav">
      <a class="active" href="./">Football</a>
      <a href="./extras.html">Extras</a>
    </div>
  </header>

  <div class="wrap">
    <!-- Left panel -->
    <section class="card">
      <h2>Left Panel</h2>
      <img class="gif" src="https://media3.giphy.com/media/v1.Y2lkPTc5MGI3NjExcThlOWlqcmc5YnZmcTVtaDByZHdpZHd4cWo4YTl0NXB4NGlxNnFlaSZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/yRl0DstAx4nN0RjDLV/giphy.gif" alt="">
    </section>

    <!-- Table -->
    <section class="card">
      <h2>
        <span>Premier League Table</span>
        <small class="pill">Updated: <span id="updated">—</span></small>
      </h2>
      <div class="panel-body">
        <table id="pl-table">
          <thead>
            <tr>
              <th class="num">#</th>
              <th>Team</th>
              <th class="tight">P</th>
              <th class="tight">W</th>
              <th class="tight">D</th>
              <th class="tight">L</th>
              <th class="tight">GF</th>
              <th class="tight">GA</th>
              <th class="tight">GD</th>
              <th class="tight">Pts</th>
            </tr>
          </thead>
          <tbody id="pl-rows">
            <tr><td colspan="10" style="text-align:center; padding:18px">Loading…</td></tr>
          </tbody>
        </table>
      </div>
    </section>

    <!-- Fixtures -->
    <section class="card">
      <h2>Man United – Fixtures &amp; Results</h2>
      <div class="panel-body">
        <h3 style="margin:6px 0 8px; color:#cde3ff; font-size:14px">Upcoming</h3>
        <table class="fixture-table" id="upcoming">
          <thead>
          <tr>
            <th>Date (UK)</th><th>Time</th><th>Comp</th><th>Home</th><th>Away</th><th>TV (UK)</th>
          </tr>
          </thead>
          <tbody><tr><td colspan="6" style="text-align:center; padding:10px">Loading…</td></tr></tbody>
        </table>

        <h3 style="margin:16px 0 8px; color:#cde3ff; font-size:14px">Recent Results</h3>
        <table class="fixture-table" id="recent">
          <thead>
          <tr>
            <th>Date</th><th>Comp</th><th>Home</th><th>Away</th><th>Score</th><th>Highlights</th>
          </tr>
          </thead>
          <tbody><tr><td colspan="6" style="text-align:center; padding:10px">Loading…</td></tr></tbody>
        </table>
      </div>
    </section>
  </div>

  <script>
    // -------- helpers
    const BUST = () => `?t=${Date.now()}`;
    const $ = (s) => document.querySelector(s);
    let BADGES = {};

    async function getJSON(path){
      const r = await fetch(path + BUST(), {cache:'no-store'});
      if(!r.ok) throw new Error(`${path} -> ${r.status}`);
      return r.json();
    }
    async function getText(path){
      const r = await fetch(path + BUST(), {cache:'no-store'});
      if(!r.ok) throw new Error(`${path} -> ${r.status}`);
      return r.text();
    }
    function initials(name){ return (name||'').split(/\s+/).map(w=>w[0]).join('').slice(0,3).toUpperCase(); }
    function coerceNum(v){ const n = parseInt(v,10); return isNaN(n) ? '' : n; }

    function badgeCell(team){
      const url = BADGES[team];
      if(url){
        return `<span class="badge"><img src="${url}" alt="" style="width:18px;height:18px;border-radius:999px;display:block"></span>`;
      }
      return `<span class="badge">${initials(team)}</span>`;
    }

    async function loadBadges(){
      try{ BADGES = await getJSON('/assets/badges.json'); }
      catch{ BADGES = {}; }
    }

    async function loadUpdated(){
      try{
        // use mtime rather than content
        const res = await fetch('/assets/update_stamp.txt' + BUST(), {method:'HEAD'});
        const m = res.headers.get('last-modified');
        $('#updated').textContent = m ? new Date(m).toLocaleString() : new Date().toLocaleString();
      }catch{
        $('#updated').textContent = '—';
      }
    }

    // ---- TABLE: robust extraction (array at root OR nested)
    function findArrayDeep(obj){
      if (Array.isArray(obj)) return obj;
      if (obj && typeof obj === 'object'){
        for (const k of Object.keys(obj)){
          const found = findArrayDeep(obj[k]);
          if (found) return found;
        }
      }
      return null;
    }

    function normalizeTableRow(row){
      // map lots of possible key names into a common shape
      const team = row.team ?? row.name ?? row.club ?? row.Team ?? row.teamName ?? row.shortName ?? '';
      const played = row.played ?? row.p ?? row.P ?? row.playedGames ?? '';
      const won    = row.won ?? row.w ?? row.W ?? '';
      const draw   = row.draw ?? row.d ?? row.D ?? row.drawn ?? '';
      const lost   = row.lost ?? row.l ?? row.L ?? '';
      const gf     = row.goalsFor ?? row.gf ?? row.F ?? row.for ?? '';
      const ga     = row.goalsAgainst ?? row.ga ?? row.A ?? row.against ?? '';
      const gd     = row.goalDiff ?? row.gd ?? row.GD ?? (gf!==''&&ga!==''?(gf-ga):'');
      const pts    = row.points ?? row.pts ?? row.Pts ?? row.PTS ?? '';
      const pos    = row.position ?? row.pos ?? row.rank ?? '';

      return {
        team: String(team||''),
        pos: coerceNum(pos),
        played: coerceNum(played), won: coerceNum(won), draw: coerceNum(draw), lost: coerceNum(lost),
        goalsFor: coerceNum(gf), goalsAgainst: coerceNum(ga), goalDiff: coerceNum(gd), points: coerceNum(pts),
      };
    }

    async function loadTable(){
      const body = $('#pl-rows');
      try{
        const raw = await getJSON('/assets/table.json');
        let arr = Array.isArray(raw) ? raw : null;

        if(!arr){
          // common wrappers: standings, table, records, data, etc.
          const candidates = [
            raw?.standings, raw?.table, raw?.records, raw?.data, raw?.leagueTable, raw?.result,
          ].filter(Boolean);
          for (const c of candidates){
            if (Array.isArray(c)) { arr = c; break; }
            if (!arr) arr = findArrayDeep(c);
            if (arr) break;
          }
          if(!arr) arr = findArrayDeep(raw);
        }
        if(!arr || !arr.length) throw new Error('no rows');

        let rows = arr.map(normalizeTableRow)
          .filter(r => r.team && (r.points!=='' || r.played!=='')); // sanity

        // sort by position if available, else by points desc, GD desc
        if (rows.every(r => r.pos !== '')){
          rows.sort((a,b)=>a.pos-b.pos);
        } else {
          rows.sort((a,b)=>(b.points - a.points) || (b.goalDiff - a.goalDiff));
        }

        // SHOW ALL 20
        rows = rows.slice(0, 20);

        body.innerHTML = rows.map((r,i)=>`
          <tr>
            <td class="num">${r.pos || (i+1)}</td>
            <td class="team">${badgeCell(r.team)} <span>${r.team}</span></td>
            <td class="tight">${r.played}</td>
            <td class="tight">${r.won}</td>
            <td class="tight">${r.draw}</td>
            <td class="tight">${r.lost}</td>
            <td class="tight">${r.goalsFor}</td>
            <td class="tight">${r.goalsAgainst}</td>
            <td class="tight">${r.goalDiff}</td>
            <td class="tight">${r.points}</td>
          </tr>
        `).join('');
      }catch(e){
        body.innerHTML = `<tr><td colspan="10" style="text-align:center; padding:14px">No table data.</td></tr>`;
      }
    }

    // ---- FIXTURES: robust extraction
    function normalizeGame(g){
      const home = g.home ?? g.homeTeam ?? g.home_name ?? g.home_team ?? g.teamHome ?? '';
      const away = g.away ?? g.awayTeam ?? g.away_name ?? g.away_team ?? g.teamAway ?? '';
      const comp = g.comp ?? g.competition ?? g.league ?? g.tournament ?? '';
      const date = g.date ?? g.utcDate ?? g.kickoff ?? g.matchDate ?? g.start ?? '';
      const timeUk = g.timeUk ?? g.time ?? g.kickoffTime ?? '';
      const status = (g.status || '').toUpperCase();
      const completed = g.completed ?? /FT|FULL|FINISHED|ENDED/.test(status);

      const hs = g.hs ?? g.homeScore ?? g.scoreHome ?? g.fullTimeHome ?? '';
      const as = g.as ?? g.awayScore ?? g.scoreAway ?? g.fullTimeAway ?? '';
      const score = (hs!=='' && as!=='' ? `${hs}–${as}` : (g.score ?? ''));
      const tv = g.tvUk ?? g.tv ?? g.channel ?? (g.broadcast && Array.isArray(g.broadcast) ? g.broadcast.join(', ') : '');

      const skyUrl = g.skyUrl ?? (g.highlights && g.highlights.sky) || '';
      const ytUrl  = g.ytUrl  ?? (g.highlights && g.highlights.yt)  || '';

      return {date, timeUk, comp, home, away, tv, completed, score, skyUrl, ytUrl};
    }

    function pickGames(raw){
      if (Array.isArray(raw)) return raw;
      const candidates = [raw?.fixtures, raw?.matches, raw?.games, raw?.data, raw?.result].filter(Boolean);
      for (const c of candidates){
        if (Array.isArray(c)) return c;
        const deep = findArrayDeep(c);
        if (deep) return deep;
      }
      return findArrayDeep(raw) || [];
    }

    function fmtDate(d){
      try{
        const dt = new Date(d);
        if(!isNaN(dt)) return dt.toLocaleDateString('en-GB', {day:'2-digit', month:'short', year:'numeric'});
      }catch{}
      return d || '';
    }

    async function loadFixtures(){
      const upT = $('#upcoming tbody');
      const reT = $('#recent tbody');
      try{
        const raw = await getJSON('/assets/fixtures.json');
        const arr = pickGames(raw).map(normalizeGame);

        const upcoming = arr.filter(g => !g.completed).slice(0, 6);
        const recent   = arr.filter(g =>  g.completed).slice(-6).reverse();

        upT.innerHTML = upcoming.length
          ? upcoming.map(g => `
            <tr>
              <td>${fmtDate(g.date)}</td>
              <td>${g.timeUk || ''}</td>
              <td>${g.comp || ''}</td>
              <td>${g.home || ''}</td>
              <td>${g.away || ''}</td>
              <td>${g.tv || '—'}</td>
            </tr>`).join('')
          : `<tr><td colspan="6" style="text-align:center; padding:10px">No fixtures data.</td></tr>`;

        reT.innerHTML = recent.length
          ? recent.map(g => {
              const sky = g.skyUrl ? `<a href="${g.skyUrl}" target="_blank" rel="noopener">Sky</a>` : '';
              const yt  = g.ytUrl  ? `<a href="${g.ytUrl}"  target="_blank" rel="noopener">YT</a>`  : '';
              const links = [sky, yt].filter(Boolean).join(' · ') || '—';
              return `<tr>
                <td>${fmtDate(g.date)}</td>
                <td>${g.comp || ''}</td>
                <td>${g.home || ''}</td>
                <td>${g.away || ''}</td>
                <td>${g.score || ''}</td>
                <td>${links}</td>
              </tr>`;
            }).join('')
          : `<tr><td colspan="6" style="text-align:center; padding:10px">No results data.</td></tr>`;
      }catch(e){
        upT.innerHTML = `<tr><td colspan="6" style="text-align:center; padding:10px">No fixtures data.</td></tr>`;
        reT.innerHTML = `<tr><td colspan="6" style="text-align:center; padding:10px">No results data.</td></tr>`;
      }
    }

    (async () => {
      await loadBadges();
      await Promise.all([loadUpdated(), loadTable(), loadFixtures()]);
    })();
  </script>
</body>
</html>
