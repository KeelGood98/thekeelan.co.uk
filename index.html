<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Your Mum</title>

  <style>
    :root{
      --bg:#0b0f14; --card:#141a22; --text:#e9eef5; --muted:#95a1b1;
      --stroke:rgba(255,255,255,.09); --accent:#3aa0ff;
      --w:#1ec178; --d:#c7ccd4; --l:#ff5b5b;
    }
    *{box-sizing:border-box}
    html,body{margin:0;height:100%;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,"Helvetica Neue",Arial,"Noto Sans",sans-serif}
    a{color:inherit;text-decoration:none}
    .wrap{max-width:1300px;margin:0 auto;padding:18px}
    header{display:flex;align-items:center;gap:12px;justify-content:space-between;margin-bottom:14px}
    .brand{display:flex;align-items:center;gap:10px;font-weight:700}
    .dot{width:10px;height:10px;border-radius:50%;background:var(--accent);display:inline-block;box-shadow:0 0 16px var(--accent)}
    nav{display:flex;gap:8px}
    nav a{padding:8px 12px;border:1px solid var(--stroke);border-radius:999px;opacity:.92}
    nav a.active{background:var(--accent);border-color:transparent;color:#04121f;font-weight:600}

    .grid{display:grid;grid-template-columns:360px 1fr 520px;gap:18px}
    .card{background:var(--card);border:1px solid var(--stroke);border-radius:14px;box-shadow:0 10px 30px rgba(0,0,0,.25);overflow:hidden}
    .card h2{margin:0;padding:14px 16px;border-bottom:1px solid var(--stroke);font-size:20px}
    .card-body{padding:14px 16px}

    /* Left GIF + embed */
    .gif{width:100%;display:block}

    .embed{border:0;width:100%;height:580px}

    /* Table */
    table{width:100%;border-collapse:collapse}
    th,td{padding:10px 8px;text-align:center;font-size:14px}
    th{text-transform:uppercase;letter-spacing:.06em;font-size:12px;color:var(--muted)}
    tbody tr{border-top:1px solid var(--stroke)}
    tbody tr:hover{background:rgba(255,255,255,.03)}
    td.team{text-align:left;display:flex;align-items:center;gap:10px}
    .badge{width:18px;height:18px;border-radius:50%;display:inline-grid;place-items:center;background:#0f1319;border:1px solid var(--stroke);overflow:hidden}
    .badge img{width:100%;height:100%;object-fit:contain}
    .badge span{font-size:10px;color:var(--muted);font-weight:700}

    .table-wrap{max-height:560px;overflow:auto}

    /* Fixtures */
    .fx-head{display:flex;justify-content:space-between;align-items:center;padding:0 16px 10px 16px}
    .subtle{color:var(--muted);font-size:12px}
    .pill{display:inline-block;padding:2px 8px;border-radius:999px;border:1px solid var(--stroke);font-size:12px;color:var(--muted)}
    .w{color:var(--w)} .d{color:var(--d)} .l{color:var(--l)}
    .fixture-table th, .fixture-table td{padding:8px}
    .fixture-table th{font-size:11px}
    .fixture-table td{font-size:14px}
    .divider{height:1px;background:var(--stroke);margin:10px 0}

    /* background spices */
    body::after{
      content:"";position:fixed;inset:0;pointer-events:none;
      background:
        radial-gradient(1200px 600px at 65% 85%, rgba(58,160,255,.08), transparent 60%),
        radial-gradient(900px 500px at 20% 10%, rgba(255,255,255,.05), transparent 60%);
      mix-blend-mode:screen;
    }

    @media (max-width:1200px){
      .grid{grid-template-columns:1fr}
      .embed{height:520px}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand"><span class="dot"></span> thekeelan.co.uk</div>
      <nav>
        <a class="active" href="./">Football</a>
        <a href="./extras.html">Extras</a>
      </nav>
    </header>

    <div class="grid">
      <!-- LEFT -->
      <div class="card">
        <h2>Left Panel</h2>
        <img class="gif" src="https://media3.giphy.com/media/v1.Y2lkPTc5MGI3NjExcThlOWlqcmc5YnZmcTVtaDByZHdpZHd4cWo4YTl0NXB4NGlxNnFlaSZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/yRl0DstAx4nN0RjDLV/giphy.gif" alt="gif" />
        <div class="card-body">
          <h2 style="margin:-2px 0 8px 0;">R6 Tracker</h2>
          <!-- Same embed that worked earlier -->
          <iframe
            class="embed"
            src="https://tracker.gg/r6/profile/ubisoft/BambyOnSpice/overview?embed=true"
            loading="lazy"
            referrerpolicy="no-referrer-when-downgrade"
          ></iframe>
        </div>
      </div>

      <!-- MIDDLE: TABLE -->
      <div class="card" id="table-card">
        <div class="fx-head" style="padding-top:14px">
          <h2 style="border:none;padding:0">Premier League Table</h2>
          <div class="subtle" id="tableStamp"></div>
        </div>
        <div class="table-wrap">
          <table id="pl-table" aria-label="Premier League Table">
            <thead>
              <tr>
                <th>#</th><th style="text-align:left">Team</th>
                <th>P</th><th>W</th><th>D</th><th>L</th><th>GF</th><th>GA</th><th>GD</th><th>Pts</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>

      <!-- RIGHT: FIXTURES -->
      <div class="card" id="fx-card">
        <div class="fx-head">
          <h2 style="border:none;padding:0">Man United – Fixtures &amp; Results</h2>
          <div class="subtle" id="updatedStamp">—</div>
        </div>

        <div class="card-body">
          <h3 style="margin:0 0 6px 0;">Upcoming</h3>
          <table class="fixture-table" id="fx-upcoming">
            <thead>
              <tr>
                <th>Date (UK)</th><th>Time (UK)</th><th>Comp</th><th>Home</th><th></th><th>Away</th><th>TV (UK)</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>

          <div class="divider"></div>

          <h3 style="margin:10px 0 6px 0;">Recent Results</h3>
          <table class="fixture-table" id="fx-recent">
            <thead>
              <tr>
                <th>Date</th><th>Comp</th><th>Home</th><th></th><th>Away</th><th>Score</th><th>Highlights</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ---------- Helpers ----------
    const bust = () => `?t=${Date.now()}`;
    const el = s => document.querySelector(s);
    const tb = s => el(s).querySelector("tbody");
    const toISODate = (iso) => {
      const d = new Date(iso);
      return isNaN(d) ? null : d;
    };
    const fmtDate = iso => {
      const d = toISODate(iso);
      return d ? d.toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"}) : "—";
    };
    const fmtTime = iso => {
      const d = toISODate(iso);
      return d ? d.toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}) : "—";
    };
    const initials = (name) => {
      const parts = (name||"").split(/\s+/).filter(Boolean);
      if (!parts.length) return "FC";
      if (parts.length === 1) return parts[0][0].toUpperCase();
      return (parts[0][0] + parts[parts.length-1][0]).toUpperCase();
    };

    async function tryFetchJSON(path){
      try{
        const r = await fetch(path + bust());
        if (!r.ok) return null;
        return await r.json();
      }catch(e){ return null; }
    }
    async function tryFetchText(path){
      try{
        const r = await fetch(path + bust());
        if (!r.ok) return null;
        return await r.text();
      }catch(e){ return null; }
    }

    // ---------- Table ----------
    async function renderTable(){
      const [table, badges] = await Promise.all([
        tryFetchJSON("/assets/table.json"),
        tryFetchJSON("/assets/badges.json")
      ]);
      const rows = (table?.standings || []);   // ALL teams
      const tBody = tb("#pl-table");
      tBody.innerHTML = "";

      rows.forEach(r=>{
        const src = badges?.[r.team] || null;
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${r.pos ?? ""}</td>
          <td class="team">
            <span class="badge">
              ${src ? `<img src="${src}" alt="${r.team} badge">` : `<span>${initials(r.team)}</span>`}
            </span>
            <span>${r.team}</span>
          </td>
          <td>${r.played ?? ""}</td>
          <td>${r.won ?? ""}</td>
          <td>${r.drawn ?? ""}</td>
          <td>${r.lost ?? ""}</td>
          <td>${r.gf ?? ""}</td>
          <td>${r.ga ?? ""}</td>
          <td>${r.gd ?? ""}</td>
          <td>${r.pts ?? ""}</td>
        `;
        tBody.appendChild(tr);
      });

      if (table?.updated){
        const d = new Date(table.updated);
        if (!isNaN(d)) el("#tableStamp").textContent = `Updated: ${d.toLocaleString("en-GB")}`;
      }
      return table?.updated || 0;
    }

    // ---------- Fixtures ----------
    function tvFromOverrides(m, overrides){
      if (!overrides) return null;
      // Try a few forgiving matches: by ISO date (yyyy-mm-dd) & opponent/home/away
      const day = (m.date||"").slice(0,10);
      const cand = overrides.find(o=>{
        const sameDay = o.date ? (o.date===day) : true;
        const opp = (str)=> (str||"").toLowerCase();
        const anyTeamMatch = o.home ? opp(o.home)===opp(m.home) : true;
        const anyAwayMatch = o.away ? opp(o.away)===opp(m.away) : true;
        return sameDay && anyTeamMatch && anyAwayMatch;
      });
      return cand?.tv || null;
    }

    async function renderFixtures(){
      const [fx, overrides] = await Promise.all([
        tryFetchJSON("/assets/fixtures.json"),
        tryFetchJSON("/assets/tv_overrides.json")
      ]);

      const MU = "Manchester United";
      const list = (fx?.matches || []).filter(m =>
        (m.home||"").toLowerCase() === MU.toLowerCase() ||
        (m.away||"").toLowerCase() === MU.toLowerCase()
      );

      // Upcoming
      const upcoming = list
        .filter(m => m.status==="SCHEDULED" || !m.score)
        .sort((a,b)=> new Date(a.date) - new Date(b.date))
        .slice(0,6);

      const upTB = tb("#fx-upcoming");
      upTB.innerHTML = upcoming.length ? "" : `<tr><td colspan="7" class="subtle">No upcoming fixtures.</td></tr>`;
      upcoming.forEach(m=>{
        const tv = m.tv || tvFromOverrides(m, overrides) || "—";
        upTB.insertAdjacentHTML("beforeend", `
          <tr>
            <td>${fmtDate(m.date)}</td>
            <td>${fmtTime(m.date)}</td>
            <td>${m.comp ?? ""}</td>
            <td>${m.home ?? ""}</td>
            <td>vs</td>
            <td>${m.away ?? ""}</td>
            <td>${tv}</td>
          </tr>
        `);
      });

      // Recent
      const recent = list
        .filter(m => m.status==="FINISHED" && m.score)
        .sort((a,b)=> new Date(b.date) - new Date(a.date))
        .slice(0,6);

      const rcTB = tb("#fx-recent");
      rcTB.innerHTML = recent.length ? "" : `<tr><td colspan="7" class="subtle">No recent matches.</td></tr>`;
      recent.forEach(m=>{
        const oc = (m.score && m.score.outcome) ? m.score.outcome.toLowerCase() : "";
        const ocLabel = oc ? `<span class="${oc} pill">${oc.toUpperCase()}</span>` : "";
        const scoreTxt = (m.score) ? `${m.score.home}–${m.score.away}` : "—";
        rcTB.insertAdjacentHTML("beforeend", `
          <tr>
            <td>${fmtDate(m.date)}</td>
            <td>${m.comp ?? ""}</td>
            <td>${m.home ?? ""}</td>
            <td>vs</td>
            <td>${m.away ?? ""}</td>
            <td>${scoreTxt} ${ocLabel}</td>
            <td>
              ${m.highlights?.sky ? `<a class="pill" href="${m.highlights.sky}" target="_blank" rel="noopener">Sky</a>` : ""}
              ${m.highlights?.yt  ? `<a class="pill" href="${m.highlights.yt}"  target="_blank" rel="noopener">YT</a>`  : ""}
            </td>
          </tr>
        `);
      });

      // Updated stamp (max of table/fixtures/update_stamp)
      let stamp = 0;
      if (fx?.updated) stamp = Math.max(stamp, fx.updated);
      return stamp;
    }

    async function loadPage(){
      const [tableUpdated, fixturesUpdated] = await Promise.all([
        renderTable(),
        renderFixtures()
      ]);

      // Also allow update_stamp.txt as a last-resort stamp
      let stamp = Math.max(Number(tableUpdated||0), Number(fixturesUpdated||0));
      if (!stamp){
        const txt = await tryFetchText("/assets/update_stamp.txt");
        if (txt){
          const d = new Date(txt.trim());
          if (!isNaN(d)) stamp = d.getTime();
        }
      }
      if (stamp){
        const d = new Date(stamp);
        el("#updatedStamp").textContent = `Last updated: ${d.toLocaleString("en-GB")}`;
      }
    }

    loadPage();
  </script>
</body>
</html>
