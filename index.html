<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>thekeelan.co.uk — Football</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><circle cx=%2250%22 cy=%2250%22 r=%2245%22 fill=%22%2300d4ff%22/></svg>">
  <style>
    :root{
      --bg:#0c1117; --panel:#121823; --muted:#95a2b3; --text:#e6edf3; --accent:#00d4ff;
      --ok:#19c37d; --warn:#e3b341; --bad:#f07470; --row:#0f1520;
      --card-radius:16px; --gap:18px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; background:radial-gradient(1200px 600px at 70% -10%, #0d2238 0%, #0c1117 60%);
      color:var(--text); font:14px/1.45 system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
    }
    header{
      display:flex; justify-content:space-between; align-items:center;
      padding:14px 18px; color:var(--muted);
    }
    header .nav a{
      display:inline-block; margin-left:8px; padding:6px 12px; border-radius:999px;
      background:#0b1422; color:#cde3ff; text-decoration:none;
      border:1px solid #0e2139; transition:all .15s;
    }
    header .nav a.active{background:#0a7cc0; border-color:#0a7cc0; color:#fff}

    .wrap{
      max-width:1400px; margin:0 auto; padding:0 18px 28px;
      display:grid; grid-template-columns: 1fr 1.2fr 1fr; gap:var(--gap);
    }
    .card{
      background:var(--panel); border:1px solid #0f2237; border-radius:var(--card-radius);
      box-shadow:0 0 0 1px rgba(255,255,255,.02) inset;
      overflow:hidden;
    }
    .card h2{
      margin:0; padding:14px 16px; font-size:16px; font-weight:700; letter-spacing:.2px;
      border-bottom:1px solid #0f2237; display:flex; justify-content:space-between; align-items:center;
      background:linear-gradient(180deg, rgba(255,255,255,.02), transparent);
    }
    .panel-body{ padding:12px 14px; }

    /* Left GIF */
    .gif{
      width:100%; aspect-ratio:16/9; object-fit:cover; border-bottom-left-radius:0; border-bottom-right-radius:0;
      display:block;
    }

    /* Table */
    table{width:100%; border-collapse:collapse; font-size:14px}
    thead th{
      text-align:left; color:var(--muted); font-weight:600; padding:10px 8px; position:sticky; top:0;
      background:var(--panel); z-index:1; border-bottom:1px solid #0f2237;
    }
    tbody td{ padding:10px 8px; border-bottom:1px solid #0f2237; }
    tbody tr:nth-child(odd){ background:var(--row) }
    .num{ text-align:center; width:28px; color:#a8b6c6 }
    .tight{ width:26px; text-align:center }
    .team{
      display:flex; align-items:center; gap:10px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
    }
    .badge{
      width:18px; height:18px; border-radius:999px; background:#0a2540; display:inline-grid; place-items:center; font-size:11px; color:#cde3ff;
      flex:0 0 18px;
    }
    .grid{
      display:grid; grid-template-columns: 1fr 1.2fr 1fr; gap:var(--gap)
    }
    @media (max-width:1100px){
      .wrap{ grid-template-columns:1fr; }
      .grid{ grid-template-columns:1fr; }
    }

    .pill{font-size:12px; color:#9fb3c8; background:#0b1422; border:1px solid #0e2139; padding:4px 8px; border-radius:999px}
    .ok{color:#19c37d} .warn{color:#e3b341} .bad{color:#f07470}

    .fixture-table td,.fixture-table th{ padding:8px 10px }
  </style>
</head>
<body>
  <header>
    <div>thekeelan.co.uk</div>
    <div class="nav">
      <a class="active" href="./">Football</a>
      <a href="./extras.html">Extras</a>
    </div>
  </header>

  <div class="wrap">
    <!-- Left panel -->
    <section class="card">
      <h2>Left Panel</h2>
      <img class="gif" src="https://media3.giphy.com/media/v1.Y2lkPTc5MGI3NjExcThlOWlqcmc5YnZmcTVtaDByZHdpZHd4cWo4YTl0NXB4NGlxNnFlaSZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/yRl0DstAx4nN0RjDLV/giphy.gif" alt="">
    </section>

    <!-- Table -->
    <section class="card">
      <h2>
        <span>Premier League Table</span>
        <small class="pill">Updated: <span id="updated">—</span></small>
      </h2>
      <div class="panel-body">
        <table id="pl-table">
          <thead>
            <tr>
              <th class="num">#</th>
              <th>Team</th>
              <th class="tight">P</th>
              <th class="tight">W</th>
              <th class="tight">D</th>
              <th class="tight">L</th>
              <th class="tight">GF</th>
              <th class="tight">GA</th>
              <th class="tight">GD</th>
              <th class="tight">Pts</th>
            </tr>
          </thead>
          <tbody id="pl-rows">
            <tr><td colspan="10" style="text-align:center; padding:18px">Loading…</td></tr>
          </tbody>
        </table>
      </div>
    </section>

    <!-- Fixtures -->
    <section class="card">
      <h2>Man United – Fixtures &amp; Results</h2>
      <div class="panel-body">
        <h3 style="margin:6px 0 8px; color:#cde3ff; font-size:14px">Upcoming</h3>
        <table class="fixture-table" id="upcoming">
          <thead>
          <tr>
            <th>Date (UK)</th><th>Time</th><th>Comp</th><th>Home</th><th>Away</th><th>TV (UK)</th>
          </tr>
          </thead>
          <tbody><tr><td colspan="6" style="text-align:center; padding:10px">Loading…</td></tr></tbody>
        </table>

        <h3 style="margin:16px 0 8px; color:#cde3ff; font-size:14px">Recent Results</h3>
        <table class="fixture-table" id="recent">
          <thead>
          <tr>
            <th>Date</th><th>Comp</th><th>Home</th><th>Away</th><th>Score</th><th>Highlights</th>
          </tr>
          </thead>
          <tbody><tr><td colspan="6" style="text-align:center; padding:10px">Loading…</td></tr></tbody>
        </table>
      </div>
    </section>
  </div>

  <script>
    const BUST = () => `?t=${Date.now()}`;
    const get = (s) => document.querySelector(s);
    let BADGES = {};

    async function fetchJSON(path){
      const res = await fetch(path + BUST(), {cache:'no-store'});
      if(!res.ok) throw new Error(path + ' -> ' + res.status);
      return res.json();
    }
    async function fetchText(path){
      const res = await fetch(path + BUST(), {cache:'no-store'});
      if(!res.ok) throw new Error(path + ' -> ' + res.status);
      return res.text();
    }

    function initials(name){
      return name.split(/\s+/).map(w=>w[0]).join('').slice(0,3).toUpperCase();
    }
    function badgeCell(team){
      const url = BADGES[team];
      if(url){
        return `<span class="badge" style="background:#0a2540"><img src="${url}" alt="" style="width:18px;height:18px;border-radius:999px;display:block"></span>`;
      }
      return `<span class="badge">${initials(team)}</span>`;
    }

    async function loadBadges(){
      try{
        BADGES = await fetchJSON('/assets/badges.json');
      }catch(e){
        BADGES = {};
      }
    }

    async function loadUpdated(){
      try{
        const txt = await fetchText('/assets/update_stamp.txt');
        // show file mtime instead of content (content might be arbitrary)
        const res = await fetch('/assets/update_stamp.txt' + BUST(), {method:'HEAD'});
        const m = res.headers.get('last-modified');
        get('#updated').textContent = m ? new Date(m).toLocaleString() : (new Date()).toLocaleString();
      }catch(e){
        get('#updated').textContent = '—';
      }
    }

    async function loadTable(){
      const body = get('#pl-rows');
      try{
        const table = await fetchJSON('/assets/table.json');
        if(!Array.isArray(table) || table.length === 0) throw new Error('empty table');
        body.innerHTML = table.slice(0, 20).map((row, i) => {
          const { team, played, won, draw, lost, goalsFor, goalsAgainst, goalDiff, points } = row;
          return `<tr>
            <td class="num">${i+1}</td>
            <td class="team">${badgeCell(team)} <span>${team}</span></td>
            <td class="tight">${played ?? row.p ?? ''}</td>
            <td class="tight">${won ?? row.w ?? ''}</td>
            <td class="tight">${draw ?? row.d ?? ''}</td>
            <td class="tight">${lost ?? row.l ?? ''}</td>
            <td class="tight">${goalsFor ?? row.gf ?? ''}</td>
            <td class="tight">${goalsAgainst ?? row.ga ?? ''}</td>
            <td class="tight">${goalDiff ?? row.gd ?? ''}</td>
            <td class="tight">${points ?? row.pts ?? ''}</td>
          </tr>`;
        }).join('');
      }catch(e){
        body.innerHTML = `<tr><td colspan="10" style="text-align:center; padding:14px">No table data.</td></tr>`;
      }
    }

    function fmtDate(d){
      try{
        const dt = new Date(d);
        if(!isNaN(dt)) return dt.toLocaleDateString('en-GB', {day:'2-digit', month:'short', year:'numeric'});
      }catch{}
      return d ?? '';
    }

    async function loadFixtures(){
      const upT = get('#upcoming tbody');
      const reT = get('#recent tbody');
      try{
        const data = await fetchJSON('/assets/fixtures.json');
        if(!Array.isArray(data)) throw new Error('bad fixtures');

        const upcoming = data.filter(g => !g.completed && !/FT/i.test(g.status || ''));
        const recent   = data.filter(g =>  g.completed || /FT/i.test(g.status || '')).slice(-6).reverse();

        upT.innerHTML = upcoming.length
          ? upcoming.map(g => {
              const tv = g.tvUk ?? g.tv ?? g.channel ?? '';
              return `<tr>
                <td>${fmtDate(g.date)}</td>
                <td>${g.timeUk ?? g.time ?? ''}</td>
                <td>${g.comp ?? ''}</td>
                <td>${g.home ?? ''}</td>
                <td>${g.away ?? ''}</td>
                <td>${tv || '—'}</td>
              </tr>`;
            }).join('')
          : `<tr><td colspan="6" style="text-align:center; padding:10px">No upcoming fixtures.</td></tr>`;

        reT.innerHTML = recent.length
          ? recent.map(g => {
              const hs = g.scoreHome ?? g.hs ?? '';
              const as = g.scoreAway ?? g.as ?? '';
              const sky = g.skyUrl ? `<a href="${g.skyUrl}" target="_blank" rel="noopener">Sky</a>` : '';
              const yt  = g.ytUrl  ? `<a href="${g.ytUrl}" target="_blank" rel="noopener">YT</a>`  : '';
              const links = [sky, yt].filter(Boolean).join(' · ') || '—';
              return `<tr>
                <td>${fmtDate(g.date)}</td>
                <td>${g.comp ?? ''}</td>
                <td>${g.home ?? ''}</td>
                <td>${g.away ?? ''}</td>
                <td>${hs && as ? `${hs}–${as}` : (g.score ?? '')}</td>
                <td>${links}</td>
              </tr>`;
            }).join('')
          : `<tr><td colspan="6" style="text-align:center; padding:10px">No recent results.</td></tr>`;

      }catch(e){
        upT.innerHTML = `<tr><td colspan="6" style="text-align:center; padding:10px">No fixtures data.</td></tr>`;
        reT.innerHTML = `<tr><td colspan="6" style="text-align:center; padding:10px">No results data.</td></tr>`;
      }
    }

    (async () => {
      await loadBadges();
      await Promise.all([loadUpdated(), loadTable(), loadFixtures()]);
    })();
  </script>
</body>
</html>
