<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>thekeelan.co.uk — Football</title>
  <style>
    :root{
      --bg:#0e141b; --panel:#121a23; --muted:#7a8aa0; --text:#e6eef8;
      --good:#11341d; --draw:#2a2a11; --bad:#361616; --good-ink:#a7f0b3; --draw-ink:#f2f07a; --bad-ink:#f59aa1;
      --pill:#0d2538; --pill-ink:#9ed0ff; --border:#1d2835; --accent:#42a5ff;
    }
    *{box-sizing:border-box}
    html,body{margin:0;height:100%;background:var(--bg);color:var(--text);font:16px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,'Helvetica Neue',Arial}
    a{color:var(--accent);text-decoration:none}
    .wrap{max-width:1440px;margin:0 auto;padding:16px}
    header{display:flex;align-items:center;gap:12px;margin-bottom:12px}
    header .nav a{margin-right:12px;opacity:.9}
    header .nav a.active{font-weight:600}
    header .stamp{margin-left:auto;color:var(--muted);font-size:.9rem}

    .grid{display:grid;grid-template-columns:300px 1fr 480px;gap:16px}
    @media (max-width:1200px){.grid{grid-template-columns: 1fr}}
    .card{background:var(--panel);border:1px solid var(--border);border-radius:10px;padding:12px}
    .h{font-weight:700;margin:2px 0 8px 0;font-size:1.05rem}

    /* Left GIF */
    .gifbox{height:280px;border-radius:8px;overflow:hidden;background:#000;margin-bottom:10px}
    .gifbox img{width:100%;height:100%;object-fit:cover;display:block}

    /* Table */
    table{width:100%;border-collapse:collapse}
    th,td{padding:8px 8px;border-bottom:1px solid var(--border);text-align:right}
    th:first-child, td:first-child{text-align:center}
    th:nth-child(2), td:nth-child(2){text-align:left}
    th{color:var(--muted);font-weight:600}
    .pill{display:inline-flex;align-items:center;justify-content:center;min-width:26px;height:26px;padding:0 8px;border-radius:999px;background:var(--pill);color:var(--pill-ink);font-size:.82rem}
    .muted{color:var(--muted);font-size:.92rem}
    .warn{background:#2a170a;border:1px solid #4b2a0e;color:#ffd7a1;padding:10px;border-radius:8px}

    /* Fixtures */
    .fixtureTable{width:100%;border-collapse:collapse}
    .fixtureTable th,.fixtureTable td{padding:8px;border-bottom:1px solid var(--border);font-size:.93rem}
    .resultRow.win{background:var(--good)} .resultRow.win .score{color:var(--good-ink)}
    .resultRow.draw{background:var(--draw)} .resultRow.draw .score{color:var(--draw-ink)}
    .resultRow.loss{background:var(--bad)} .resultRow.loss .score{color:var(--bad-ink)}
    .badge{display:inline-flex;align-items:center;justify-content:center;width:22px;height:22px;border-radius:999px;background:var(--pill);color:var(--pill-ink);font-size:.74rem;margin-right:6px}
    .compPill{display:inline-flex;align-items:center;justify-content:center;height:22px;padding:0 8px;border-radius:999px;background:#0b2030;color:#a7d7ff;font-size:.75rem}
    .scroll{max-height:520px;overflow:auto;border-radius:8px}
    .small{font-size:.85rem}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="nav">
        <a class="active" href="index.html">Football</a>
        <a href="extras.html">Extras</a>
      </div>
      <div class="stamp" id="lastUpdated"></div>
    </header>

    <div class="grid">
      <!-- LEFT PANEL -->
      <div class="card">
        <div class="gifbox">
          <img src="https://media.tenor.com/8G6mR3wQqDIAAAAd/stone-cold-stunner-vince-mcmahon.gif" alt="gif" />
        </div>
        <div class="h">F1 — This Season (Results)</div>
        <div id="f1Panel" class="small muted">No F1 results yet.</div>
      </div>

      <!-- CENTER: TABLE -->
      <div class="card" id="tableCard">
        <div class="h">Premier League Table</div>
        <div id="tableWarn" class="warn" style="display:none">No or partial table data. Check /assets/table.json.</div>
        <table id="leagueTable">
          <thead>
            <tr>
              <th>#</th><th>Team</th><th class="small">P</th><th class="small">W</th><th class="small">D</th><th class="small">L</th>
              <th class="small">GF</th><th class="small">GA</th><th class="small">GD</th><th class="small">Pts</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>

      <!-- RIGHT: FIXTURES -->
      <div class="card">
        <div class="h">Man United – Fixtures &amp; Results</div>

        <div class="h" style="margin-top:6px">Upcoming</div>
        <div id="upcomingWrap" class="scroll">
          <table class="fixtureTable" id="upcoming">
            <thead>
              <tr><th class="small">Date (UK)</th><th class="small">Time (UK)</th><th class="small">Comp</th><th>Home</th><th>Away</th><th class="small">TV</th></tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>

        <div class="h" style="margin-top:12px">Recent Results</div>
        <div id="resultsWrap" class="scroll">
          <table class="fixtureTable" id="results">
            <thead>
            <tr><th class="small">Date</th><th class="small">Comp</th><th>Home</th><th>Away</th><th class="small">TV</th><th class="small">Score</th></tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <script>
    async function getText(url){const r=await fetch(url); if(!r.ok) throw new Error(url); return r.text();}
    async function getJSON(url){const r=await fetch(url); if(!r.ok) throw new Error(url); return r.json();}

    function badgeSpan(t){return `<span class="badge">${(t.badge || (t.team||'').split(' ').map(s=>s[0]).slice(0,2).join('')).toUpperCase()}</span>`;}

    function setStamp(){
      getText('assets/update_stamp.txt').then(t=>{
        const ts = t.trim(); document.getElementById('lastUpdated').textContent = ts ? `Last updated: ${ts}` : '';
      }).catch(()=>{document.getElementById('lastUpdated').textContent='';});
    }

    async function loadTable(){
      try{
        const data = await getJSON('assets/table.json'); // { rows:[...] }
        const rows = (data && Array.isArray(data.rows)) ? data.rows : [];
        document.getElementById('tableWarn').style.display = rows.length>=10 ? 'none':'block';
        const tb = document.querySelector('#leagueTable tbody'); tb.innerHTML='';
        rows.forEach(r=>{
          tb.insertAdjacentHTML('beforeend', `
            <tr>
              <td>${r.pos}</td>
              <td>${badgeSpan(r)} ${r.team}</td>
              <td>${r.p}</td><td>${r.w}</td><td>${r.d}</td><td>${r.l}</td>
              <td>${r.gf}</td><td>${r.ga}</td><td>${r.gd}</td><td><strong>${r.pts}</strong></td>
            </tr>
          `);
        });
      }catch(e){
        document.getElementById('tableWarn').style.display='block';
      }
    }

    function resultClass(score){
      // return win/draw/loss from MU perspective
      const m = /(\d+)[–-](\d+)/.exec(score||''); if(!m) return 'draw';
      const h = +m[1], a = +m[2];
      // MU appears either as home or away—figure it out from the row text later?
      // Caller passes an indicator "homeName" so we can infer perspective; we won’t overcomplicate here
      return 'draw';
    }

    async function loadFixtures(){
      try{
        const data = await getJSON('assets/fixtures.json'); // { upcoming:[], results:[] }
        const up = (data && data.upcoming)||[], res=(data && data.results)||[];

        const utb = document.querySelector('#upcoming tbody'); utb.innerHTML='';
        if(up.length===0){
          utb.insertAdjacentHTML('beforeend', `<tr><td colspan="6" class="muted small">No upcoming fixtures.</td></tr>`);
        }else{
          up.forEach(x=>{
            const d = new Date(x.date); const dateStr = isNaN(d) ? (x.date||'') : d.toLocaleDateString('en-GB',{day:'2-digit',month:'short',year:'numeric'});
            utb.insertAdjacentHTML('beforeend', `
              <tr>
                <td class="small">${dateStr}</td>
                <td class="small">${x.time_uk||''}</td>
                <td class="small"><span class="compPill">${x.comp||''}</span></td>
                <td>${x.home||''}</td>
                <td>${x.away||''}</td>
                <td class="small">${x.tv||'TBD'}</td>
              </tr>
            `);
          });
        }

        const rtb = document.querySelector('#results tbody'); rtb.innerHTML='';
        if(res.length===0){
          rtb.insertAdjacentHTML('beforeend', `<tr><td colspan="6" class="muted small">No results yet.</td></tr>`);
        }else{
          res.forEach(x=>{
            const d = new Date(x.date); const dateStr = isNaN(d) ? (x.date||'') : d.toLocaleDateString('en-GB',{year:'numeric',month:'2-digit',day:'2-digit'});
            const cls = /win/i.test(x.result||'') ? 'win' : /loss|L\b/i.test(x.result||'') ? 'loss' : /draw|D\b/i.test(x.result||'') ? 'draw' : (function(){
              // derive from score when we can & assume MU perspective by checking which side contains 'Manchester United'
              const sc=/(\d+)[–-](\d+)/.exec(x.score||''); if(!sc) return 'draw';
              const h=+sc[1], a=+sc[2];
              if((x.home||'').toLowerCase().includes('manchester united')) return (h>a)?'win':(h<a)?'loss':'draw';
              if((x.away||'').toLowerCase().includes('manchester united')) return (a>h)?'win':(a<h)?'loss':'draw';
              return 'draw';
            })();
            rtb.insertAdjacentHTML('beforeend', `
              <tr class="resultRow ${cls}">
                <td class="small">${dateStr}</td>
                <td class="small"><span class="compPill">${x.comp||''}</span></td>
                <td>${x.home||''}</td>
                <td>${x.away||''}</td>
                <td class="small">${x.tv||'TBD'}</td>
                <td class="small score"><strong>${x.score||'—'}</strong></td>
              </tr>
            `);
          });
        }
      }catch(e){
        const utb = document.querySelector('#upcoming tbody');
        utb.innerHTML = `<tr><td colspan="6" class="muted small">No fixtures data (check /assets/fixtures.json).</td></tr>`;
      }
    }

    async function loadF1(){
      try{
        const data = await getJSON('assets/f1.json'); // {season, rounds:[{race, date, results:[{pos,driver,team,pts}]}]}
        const panel = document.getElementById('f1Panel');
        if(!data.rounds || data.rounds.length===0){ panel.textContent = 'No F1 results yet.'; return; }
        const items = data.rounds.slice(-5).map(r=>{
          const top = (r.results && r.results[0]) ? `${r.results[0].driver} (${r.results[0].team})` : '';
          const d = new Date(r.date); const datestr = isNaN(d)? r.date : d.toLocaleDateString('en-GB',{day:'2-digit',month:'short'});
          return `<div style="margin:6px 0;">
            <div><strong>${r.race}</strong> <span class="muted">— ${datestr}</span></div>
            <div class="small muted">Winner: ${top||'—'}</div>
          </div>`;
        }).join('');
        panel.innerHTML = items;
      }catch(e){
        // leave default text
      }
    }

    setStamp();
    loadTable();
    loadFixtures();
    loadF1();
  </script>
</body>
</html>
