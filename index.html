<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>thekeelan.co.uk</title>
  <style>
    body { background:#0d1117; color:#e6edf3; font-family:Arial, sans-serif; margin:0; padding:0; }
    header { padding:10px 20px; font-weight:bold; font-size:1.2em; }
    .container { display:grid; grid-template-columns:1fr 2fr 2fr; gap:20px; padding:20px; }
    .card { background:#161b22; padding:12px; border-radius:12px; box-shadow:0 0 6px rgba(0,0,0,0.4); }
    h2 { margin-top:0; }
    table { width:100%; border-collapse:collapse; }
    th, td { padding:4px 6px; text-align:center; border-bottom:1px solid #30363d; }
    th { font-weight:bold; }
    .muted { color:#8b949e; font-size:0.9em; }
    .team-cell { display:flex; align-items:center; gap:6px; }
    .badge { width:18px; height:18px; }
    .W { background:#033a16; }
    .D { background:#3d2b00; }
    .L { background:#490202; }
    iframe { width:100%; min-height:400px; border:none; border-radius:8px; }
  </style>
</head>
<body>
  <header>
    thekeelan.co.uk
    <span id="lastUpdated" style="float:right; font-size:0.85em; font-weight:normal;">Last updated: --</span>
  </header>
  <div class="container">
    <div class="card">
      <h2>Left Panel</h2>
      <img src="https://media3.giphy.com/media/v1.Y2lkPTc5MGI3NjExcThlOWlqcmc5YnZmcTVtaDByZHdpZHd4cWo4YTl0NXB4NGlxNnFlaSZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/yRl0DstAx4nN0RjDLV/giphy.gif" alt="gif" style="max-width:100%; border-radius:8px;" />
    </div>
    <div class="card">
      <h2>Premier League Table</h2>
      <table>
        <thead>
          <tr><th>#</th><th>Team</th><th>P</th><th>W</th><th>D</th><th>L</th><th>GF</th><th>GA</th><th>GD</th><th>Pts</th></tr>
        </thead>
        <tbody id="tableBody">
          <tr><td colspan="10" class="muted">Waiting for data...</td></tr>
        </tbody>
      </table>
    </div>
    <div class="card">
      <h2>Man United – Fixtures & Results</h2>
      <div id="fixturesWrap" class="muted">Waiting for data...</div>
      <h2>R6 Tracker</h2>
      <iframe id="r6Frame" title="R6 Tracker"></iframe>
    </div>
  </div>

<script>
(async () => {
  const bust = `?t=${Date.now()}`;

  const log = (...a) => console.log("[keelan]", ...a);
  const err = (...a) => console.error("[keelan]", ...a);

  function showError(where, msg) {
    const el = document.getElementById(where);
    if (!el) return;
    el.innerHTML = `<div class="muted">⚠️ ${msg}</div>`;
  }

  async function getJSONMulti(relPath) {
    const candidates = [
      `/assets/${relPath}`,
      `assets/${relPath}`,
      `./assets/${relPath}`
    ];
    for (const url of candidates) {
      try {
        log("Fetching", url + bust);
        const r = await fetch(url + bust, { cache: "no-store" });
        log("Response", url, r.status, r.statusText);
        if (!r.ok) { continue; }
        const data = await r.json();
        const size = Array.isArray(data) ? data.length : (data ? Object.keys(data).length : 0);
        log("Data size", url, size);
        if (size > 0) return data;
      } catch (e) { err("Fetch failed", url, e); }
    }
    return null;
  }

  function renderTableRows(rows) {
    return rows.map(r => `
      <tr>
        <td>${r.pos ?? ""}</td>
        <td><span class="team-cell">
          ${r.badge ? `<img class="badge" src="${r.badge}" alt="">` : ""}${r.team ?? ""}
        </span></td>
        <td>${r.played ?? ""}</td><td>${r.won ?? ""}</td><td>${r.drawn ?? ""}</td><td>${r.lost ?? ""}</td>
        <td>${r.gf ?? ""}</td><td>${r.ga ?? ""}</td><td>${r.gd ?? ""}</td><td><strong>${r.pts ?? ""}</strong></td>
      </tr>`).join("");
  }

  // TABLE
  const table = await getJSONMulti("table.json");
  if (!table || !Array.isArray(table.standings) || table.standings.length === 0) {
    showError("tableBody", "No table data (couldn't load assets/table.json).");
  } else {
    document.getElementById("tableBody").innerHTML = renderTableRows(table.standings);
    const lu = document.getElementById("lastUpdated");
    if (lu) lu.textContent = "Last updated: " + new Date(table.updated || Date.now()).toLocaleString();
  }

  // FIXTURES
  const fixtures = await getJSONMulti("fixtures.json");
  if (!fixtures || !Array.isArray(fixtures.matches)) {
    showError("fixturesWrap", "No fixtures data (couldn't load assets/fixtures.json).");
  } else {
    const wrap = document.getElementById("fixturesWrap");
    const isFinished = m => (m.status || "").toUpperCase() === "FINISHED";
    const outcomeClass = o => o === "W" ? "W" : o === "D" ? "D" : o === "L" ? "L" : "";
    const upcoming = fixtures.matches.filter(m => !isFinished(m)).sort((a,b)=> new Date(a.date)-new Date(b.date)).slice(0,8);
    const recent = fixtures.matches.filter(isFinished).sort((a,b)=> new Date(b.date)-new Date(a.date)).slice(0,8);
    const fmt = d => new Date(d).toLocaleString([], { dateStyle:"medium", timeStyle:"short" });

    wrap.innerHTML =
      (upcoming.length ? `
        <h3 style="margin:8px 0;">Upcoming</h3>
        <table><thead><tr><th>Date</th><th>Comp</th><th>Home</th><th></th><th>Away</th></tr></thead>
        <tbody>${upcoming.map(m=>`<tr><td>${fmt(m.date)}</td><td>${m.comp||""}</td><td>${m.home}</td><td>vs</td><td>${m.away}</td></tr>`).join("")}</tbody></table>`
      : '<div class="muted">No upcoming fixtures.</div>') +
      (recent.length ? `
        <h3 style="margin:12px 0 6px;">Recent Results</h3>
        <table><thead><tr><th>Date</th><th>Comp</th><th>Home</th><th></th><th>Away</th><th>Score</th></tr></thead>
        <tbody>${recent.map(m=>{
          const sc = m.score ? `${m.score.home}–${m.score.away}` : "";
          const oc = m.score?.outcome || "";
          return `<tr class="${outcomeClass(oc)}"><td>${new Date(m.date).toLocaleDateString()}</td><td>${m.comp||""}</td><td>${m.home}</td><td>vs</td><td>${m.away}</td><td><strong>${sc}</strong>${oc?` (${oc})`:""}</td></tr>`;
        }).join("")}</tbody></table>` : "");
  }

  // R6 Tracker
  const f = document.getElementById("r6Frame");
  if (f && !f.src) {
    f.src = "https://r6.tracker.network/profile/pc/BambyOnSpice?embed=1";
    log("Loaded R6 Tracker iframe");
  }
})();
</script>
</body>
</html>
