<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>thekeelan.co.uk</title>
<link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'%3E%3Ccircle cx='16' cy='16' r='16' fill='%236ee7ff'/%3E%3C/svg%3E">
<meta name="theme-color" content="#0b0f14"/>
<style>
:root{
  --text:#e9eef5; --muted:#9aa6b2; --card:#12161b; --border:#1e242c;
  --accent:#6ee7ff; --accent2:#a78bfa; --hdr:72px;
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0; color:var(--text);
  font:14px/1.55 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial;
  background: radial-gradient(1200px 800px at 60% -10%, rgba(110,231,255,.12), transparent 40%),
              radial-gradient(800px 700px at 80% 20%, rgba(167,139,250,.10), transparent 40%),
              #0b0f14 url('https://images.unsplash.com/photo-1517927033932-b3d18e61fb3a?auto=format&fit=crop&w=2400&q=60') center top/cover fixed;
}

/* header */
.site-header{ position:sticky;top:0;z-index:20;display:flex;gap:12px;align-items:center;
  padding:10px 18px;background:rgba(11,15,20,.6);backdrop-filter:blur(8px);border-bottom:1px solid var(--border)}
.brand{display:flex;gap:10px;align-items:center}
.brand-logo{width:28px;height:28px;border-radius:6px;background:
  radial-gradient(circle at 30% 30%,#6ee7ff,transparent 40%),
  radial-gradient(circle at 70% 70%,#a78bfa,transparent 40%);
  box-shadow:0 0 0 1px #2a3340 inset}
.brand h1{margin:0;font-size:18px}
.spacer{flex:1}
.nav a{color:var(--muted);text-decoration:none;border:1px solid var(--border);border-radius:999px;padding:6px 10px;margin-left:8px}
.nav a.active,.nav a:hover{color:var(--text);background:#0f141a;border-color:#2a3340}

/* layout */
.grid{display:grid;grid-template-columns:300px 1fr 460px;gap:18px;padding:12px 18px 24px}
@media (max-width: 1200px){.grid{grid-template-columns:1fr 1fr}}
@media (max-width: 980px){.grid{grid-template-columns:1fr}}
.card{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:14px;box-shadow:0 6px 24px rgba(0,0,0,.35)}
.card h2{margin:0 0 8px}
.panel{border:1px solid var(--border);border-radius:10px;overflow:auto}

/* table */
table{width:100%;border-collapse:collapse}
th,td{padding:8px 10px;border-bottom:1px solid var(--border);text-align:center}
thead th{position:sticky;top:0;background:#0f141a;z-index:1}
tr:hover td{background:#0f141a}
.team-cell{display:flex;align-items:center;justify-content:flex-start;gap:10px}
.badge{width:20px;height:20px;border-radius:50%;display:inline-flex;align-items:center;justify-content:center;background:#0f141a;font-size:11px;font-weight:700}
.badge.img{background:none}
.badge.initials{border:1px solid #243041;color:#b6c2cf}

/* fixtures strips */
.rowWin{background:linear-gradient(0deg,#0f2617,#142217);border-left:3px solid #1fe36d}
.rowDraw{background:linear-gradient(0deg,#26210f,#221f14);border-left:3px solid #ffe44d}
.rowLoss{background:linear-gradient(0deg,#261111,#231315);border-left:3px solid #ff4d4d}
.compDot{display:inline-flex;width:36px;height:36px;border-radius:999px;background:#0f141a;border:1px solid var(--border);align-items:center;justify-content:center;font-size:11px;color:#b6c2cf}
.compCell{display:flex;gap:8px;align-items:center}

/* F1 */
.f1item{display:grid;grid-template-columns:92px 1fr 220px;gap:8px;padding:8px;border-bottom:1px solid var(--border)}
.f1item h4{margin:0;font-size:13px}
.muted{color:var(--muted)}
</style>
</head>
<body>
<header class="site-header">
  <div class="brand">
    <div class="brand-logo" aria-hidden="true"></div>
    <h1>thekeelan.co.uk</h1>
  </div>
  <div class="spacer"></div>
  <div class="muted" id="lastUpdated">Last updated: —</div>
  <nav class="nav">
    <a href="/" class="active">Football</a>
    <a href="/extras.html">Extras</a>
  </nav>
</header>

<div class="grid">
  <!-- LEFT -->
  <section class="card">
    <h2>Left Panel</h2>
    <div style="border:1px solid var(--border);border-radius:10px;overflow:hidden;margin-bottom:12px">
      <img src="https://media3.giphy.com/media/v1.Y2lkPTc5MGI3NjExcThlOWlqcmc5YnZmcTVtaDByZHdpZHd4cWo4YTl0NXB4NGlxNnFlaSZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/yRl0DstAx4nN0RjDLV/giphy.gif" alt="" style="display:block;width:100%;height:auto">
    </div>

    <div class="card" style="margin:0;padding:10px">
      <h2>F1 — This Season (Results)</h2>
      <div id="f1Wrap" class="panel" style="padding:8px;min-height:120px">
        <div class="muted">Loading…</div>
      </div>
    </div>
  </section>

  <!-- MIDDLE -->
  <section class="card">
    <h2>Premier League Table</h2>
    <div style="border:1px solid var(--border);border-radius:10px;overflow:auto">
      <table>
        <thead>
          <tr><th>#</th><th style="text-align:left">Team</th><th>P</th><th>W</th><th>D</th><th>L</th><th>GF</th><th>GA</th><th>GD</th><th>Pts</th></tr>
        </thead>
        <tbody id="tableBody">
          <tr><td colspan="10" class="muted">Waiting for data…</td></tr>
        </tbody>
      </table>
    </div>
  </section>

  <!-- RIGHT -->
  <section class="card">
    <h2>Man United – Fixtures & Results</h2>
    <div id="fixturesWrap" class="panel" style="padding:8px;max-height:calc(100dvh - 140px);min-height:220px">
      <div class="muted">Waiting for data…</div>
    </div>
  </section>
</div>

<script>
(async () => {
  const bust = '?t=' + Date.now();

  // local asset helper
  const get = async (p, asText=false) => {
    for (const u of ["/assets/"+p, "assets/"+p, "./assets/"+p]) {
      try {
        const r = await fetch(u + bust, {cache:"no-store"});
        if (r.ok) return asText ? r.text() : r.json();
      } catch {}
    }
    return null;
  };

  const norm = s => (s||"").toLowerCase().replace(/&/g,"and").replace(/[^a-z0-9]/g,"");

  /* ===== TABLE with local badges ===== */
  const [table, badges] = await Promise.all([get("table.json"), get("badges.json")]);
  const tbody = document.getElementById("tableBody");
  const lu = document.getElementById("lastUpdated");

  const localBadges = {};
  if (badges?.badges) for (const [k,v] of Object.entries(badges.badges)) localBadges[k]=v;

  const initials = team => team.split(/\s+/).filter(Boolean).map(w=>w[0]).slice(0,2).join('').toUpperCase();

  function rowHTML(r){
    const b = localBadges[norm(r.team)];
    const badge = b ? `<img class="badge img" referrerpolicy="no-referrer" src="${b}" alt="">`
                    : `<span class="badge initials">${initials(r.team)}</span>`;
    return `<tr>
      <td>${r.pos ?? ""}</td>
      <td style="text-align:left"><span class="team-cell">${badge}<span>${r.team ?? ""}</span></span></td>
      <td>${r.played ?? ""}</td><td>${r.won ?? ""}</td><td>${r.drawn ?? ""}</td><td>${r.lost ?? ""}</td>
      <td>${r.gf ?? ""}</td><td>${r.ga ?? ""}</td><td>${r.gd ?? ""}</td><td><strong>${r.pts ?? ""}</strong></td>
    </tr>`;
  }

  if (!table?.standings?.length) {
    tbody.innerHTML = `<tr><td colspan="10"><div class="muted">⚠️ No table data (check /assets/table.json).</div></td></tr>`;
  } else {
    tbody.innerHTML = table.standings.map(rowHTML).join("");
    if (lu) lu.textContent = "Last updated: " + new Date(table.updated || Date.now()).toLocaleString();
  }

  /* ===== FIXTURES (use your existing JSON) ===== */
  const fixtures = await get("fixtures.json");
  const wrap = document.getElementById("fixturesWrap");

  function cls(outcome){ return outcome==="W"?"rowWin": outcome==="D"?"rowDraw": outcome==="L"?"rowLoss": "" }
  const fmtD = d => new Date(d).toLocaleDateString('en-GB',{day:'2-digit',month:'short',year:'numeric', timeZone:'Europe/London'});
  const fmtT = d => new Date(d).toLocaleTimeString('en-GB',{hour:'2-digit',minute:'2-digit', hour12:false, timeZone:'Europe/London'});

  if (!fixtures?.matches?.length) {
    wrap.innerHTML = `<div class="muted">⚠️ No fixtures data (check /assets/fixtures.json).</div>`;
  } else {
    const t = s => new Date(s).getTime() || 0;
    const isFinished = m => (m.status||"").toUpperCase()==="FINISHED" ||
                            (m.score && typeof m.score.home==="number" && typeof m.score.away==="number") ||
                            t(m.date)<Date.now();

    const all = fixtures.matches.slice().sort((a,b)=>t(a.date)-t(b.date));
    const upcoming = all.filter(m=>!isFinished(m)).slice(0,8);
    const recent   = all.filter(isFinished).sort((a,b)=>t(b.date)-t(a.date)).slice(0,8);

    const upHTML = upcoming.length ? `
      <h3 style="margin:6px 0 10px">Upcoming</h3>
      <table>
        <thead><tr><th>Date (UK)</th><th>Time (UK)</th><th>Comp</th><th>Home</th><th></th><th>Away</th><th>TV</th></tr></thead>
        <tbody>
          ${upcoming.map(m=>`
            <tr>
              <td>${fmtD(m.date)}</td><td>${fmtT(m.date)}</td>
              <td class="compCell"><span class="compDot">EPL</span></td>
              <td>${m.home}</td><td>vs</td><td>${m.away}</td>
              <td>${(m.tv||"TBD")}</td>
            </tr>`).join("")}
        </tbody>
      </table>` : `<div class="muted">No upcoming fixtures.</div>`;

    const recHTML = recent.length ? `
      <h3 style="margin:12px 0 6px">Recent Results</h3>
      <table>
        <thead><tr><th>Date</th><th>Comp</th><th>Home</th><th></th><th>Away</th><th>Score</th><th>Highlights</th></tr></thead>
        <tbody>
          ${recent.map(m=>{
            const sc = m.score ? `${m.score.home}–${m.score.away}` : "";
            const oc = m.score?.outcome || "";
            const year = new Date(m.date).getFullYear();
            const q = encodeURIComponent(`${m.home} ${m.away} highlights ${year}`);
            const sky = `https://www.skysports.com/search?q=${q}`;
            const yt  = `https://www.youtube.com/results?search_query=${q}`;
            return `<tr class="${cls(oc)}">
              <td>${fmtD(m.date)}</td>
              <td class="compCell"><span class="compDot">EPL</span></td>
              <td>${m.home}</td><td>vs</td><td>${m.away}</td>
              <td><strong>${sc}</strong>${oc?` (${oc})`:""}</td>
              <td><a class="btn" href="${sky}" target="_blank" rel="noopener">Sky</a>
                  <a class="btn" style="margin-left:6px" href="${yt}" target="_blank" rel="noopener">YT</a></td>
            </tr>`;}).join("")}
        </tbody>
      </table>` : "";
    wrap.innerHTML = upHTML + recHTML;
  }

  /* ===== F1 from local assets/f1.json (built by workflow) ===== */
  const f1 = await get("f1.json");
  const f1Wrap = document.getElementById("f1Wrap");
  if (!f1?.races?.length) {
    f1Wrap.innerHTML = `<div class="muted">No F1 results yet.</div>`;
  } else {
    // Show the latest 8
    const rows = f1.races.slice(-8).reverse().map(r=>`
      <div class="f1item">
        <div class="muted">${new Date(r.date).toLocaleDateString('en-GB',{day:'2-digit',month:'short'})}</div>
        <h4>${r.raceName} <span class="muted">— ${r.country||r.circuit||""}</span></h4>
        <div class="muted">P1: <b>${r.p1||""}</b> &nbsp; P2: ${r.p2||""} &nbsp; P3: ${r.p3||""}</div>
      </div>`).join("");
    f1Wrap.innerHTML = rows;
  }

})();
</script>
</body>
</html>
