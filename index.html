<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>thekeelan.co.uk</title>
<meta name="theme-color" content="#0b0f14" />
<link rel="icon" type="image/svg+xml" href="/assets/favicon.svg" />
<style>
:root{
  --text:#e9eef5; --muted:#9aa6b2; --card:#12161b; --border:#1e242c; --accent:#6ee7ff; --accent2:#a78bfa;
  --hdr:52px;
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0; color:var(--text); font:14px/1.55 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial;
  background:
    linear-gradient(180deg, rgba(0,0,0,0.60), rgba(0,0,0,0.80)),
    url('https://images.unsplash.com/photo-1517927033932-b3d18e61fb3a?auto=format&fit=crop&w=2400&q=60') center top / cover no-repeat fixed;
  background-color:#0b0f14;
}
header{display:flex;gap:10px;align-items:center;justify-content:space-between;padding:10px 14px;border-bottom:1px solid var(--border);backdrop-filter:blur(6px);position:sticky;top:0;z-index:5;background:rgba(11,15,20,.6)}
.brand{display:flex;gap:10px;align-items:center}
.brand-logo{width:24px;height:24px;border-radius:6px;background:
  radial-gradient(circle at 30% 30%,#6ee7ff,transparent 40%),
  radial-gradient(circle at 70% 70%,#a78bfa,transparent 40%); box-shadow:0 0 0 1px #2a3340 inset}
.nav a{color:var(--muted);text-decoration:none;margin-left:10px;border:1px solid var(--border);border-radius:999px;padding:6px 10px}
.nav a:hover{color:var(--text);background:#0f141a;border-color:#2a3340}
.nav a.active{color:var(--text);background:linear-gradient(90deg,rgba(110,231,255,.20),rgba(167,139,250,.20));box-shadow:0 0 0 1px rgba(110,231,255,.25) inset;border-color:transparent}
#lastUp{color:var(--muted);font-size:12px}

.grid{display:grid;grid-template-columns:1.1fr 1.6fr 1.2fr;gap:18px;padding:14px}
@media (max-width:1200px){.grid{grid-template-columns:1fr 1fr}}
@media (max-width:980px){.grid{grid-template-columns:1fr}}

.card{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:14px;box-shadow:0 6px 24px rgba(0,0,0,.35)}
.card h2{margin:0 0 8px}
.panel{border:1px solid var(--border);border-radius:10px;overflow:auto}

table{width:100%;border-collapse:collapse}
th,td{padding:8px 10px;border-bottom:1px solid var(--border);text-align:center}
thead th{position:sticky;top:0;background:#0f141a;z-index:1}
tr:hover td{background:#0f141a}
.team-cell{display:flex;align-items:center;justify-content:center;gap:8px}
.badge{width:20px;height:20px;border-radius:50%;display:inline-flex;align-items:center;justify-content:center;background:#0f141a;font-weight:700;font-size:11px;letter-spacing:.5px}
.badge.img{background:none}
.badge.initials{background: radial-gradient(closest-side,#1a2430,#0f141a);border:1px solid #243041;color:#b6c2cf;text-transform:uppercase}

.W{background:#10361f} .D{background:#2b2b17} .L{background:#3a1a1a}
a.btn{display:inline-block;padding:2px 8px;border:1px solid var(--border);border-radius:8px;font-size:12px}
</style>
</head>
<body>
<header>
  <div class="brand">
    <div class="brand-logo" aria-hidden="true"></div>
    <strong>thekeelan.co.uk</strong>
  </div>
  <div id="lastUp">Last updated: —</div>
  <nav class="nav" aria-label="Primary">
    <a href="/" class="active">Football</a>
    <a href="/extras.html">Extras</a>
  </nav>
</header>

<div class="grid">
  <!-- Left -->
  <section class="card">
    <h2>Left Panel</h2>
    <div class="panel" style="overflow:hidden">
      <img src="https://media3.giphy.com/media/v1.Y2lkPTc5MGI3NjExcThlOWlqcmc5YnZmcTVtaDByZHdpZHd4cWo4YTl0NXB4NGlxNnFlaSZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/yRl0DstAx4nN0RjDLV/giphy.gif"
           alt="" style="display:block;width:100%;height:auto" />
    </div>
  </section>

  <!-- Centre -->
  <section class="card" style="align-self:start;">
    <h2>Premier League Table</h2>
    <div class="panel">
      <table>
        <thead>
          <tr><th>#</th><th>Team</th><th>P</th><th>W</th><th>D</th><th>L</th><th>GF</th><th>GA</th><th>GD</th><th>Pts</th></tr>
        </thead>
        <tbody id="tableBody"><tr><td colspan="10" style="color:#9aa6b2">Loading…</td></tr></tbody>
      </table>
    </div>
  </section>

  <!-- Right -->
  <section class="card" style="display:flex;flex-direction:column;min-height:420px">
    <h2>Man United – Fixtures & Results</h2>
    <div class="panel" id="fixturesWrap" style="padding:8px;flex:1;min-height:0">
      <div style="color:#9aa6b2">Loading…</div>
    </div>
  </section>
</div>

<script>
(async ()=>{
  const bust = `?t=${Date.now()}`;
  const get = async p => {
    for (const u of [`/assets/${p}`, `assets/${p}`, `./assets/${p}`]) {
      try { const r = await fetch(u + bust, {cache:'no-store'}); if (r.ok) return r; } catch{}
    }
    return null;
  };
  const getJSON = async p => { const r = await get(p); return r ? r.json() : null; };
  const getText = async p => { const r = await get(p); return r ? r.text() : ""; };

  // Last updated from update_stamp.txt
  const lastUp = document.getElementById('lastUp');
  const stamp = (await getText('update_stamp.txt')).trim();
  if (stamp) lastUp.textContent = 'Last updated: ' + stamp;

  // ---- table + badges
  const table = await getJSON('table.json');
  const badges = await getJSON('badges.json');
  const badgeMap = (badges && badges.badges) ? badges.badges : {};
  const tbody = document.getElementById('tableBody');

  const n = s => (s||"").toLowerCase().replace(/&/g,"and").replace(/[^a-z0-9]/g,"");
  const initials = t => (t||"").split(/\s+/).filter(Boolean).map(w=>w[0]).slice(0,2).join('').toUpperCase();
  const toHttps = u => (u||"").replace(/^http:\/\//i,"https://");

  function rowHTML(r){
    const crest = toHttps(badgeMap[n(r.team)]);
    const badge = crest
      ? `<img class="badge img" src="${crest}" referrerpolicy="no-referrer" alt="">`
      : `<span class="badge initials">${initials(r.team)}</span>`;
    return `<tr>
      <td>${r.pos}</td>
      <td><span class="team-cell">${badge}${r.team}</span></td>
      <td>${r.played}</td><td>${r.won}</td><td>${r.drawn}</td><td>${r.lost}</td>
      <td>${r.gf}</td><td>${r.ga}</td><td>${r.gd}</td><td><strong>${r.pts}</strong></td>
    </tr>`;
  }

  if (!table?.standings?.length){
    tbody.innerHTML = `<tr><td colspan="10" style="color:#9aa6b2">⚠ No table data (check /assets/table.json).</td></tr>`;
  } else {
    tbody.innerHTML = table.standings.map(rowHTML).join('');
  }

  // ---- fixtures
  const fx = await getJSON('fixtures.json');
  const wrap = document.getElementById('fixturesWrap');

  function dUK(s){ try{ return new Date(s).toLocaleDateString('en-GB',{day:'2-digit',month:'short',year:'numeric',timeZone:'Europe/London'});}catch{ return s||''; } }
  function tUK(s){ try{ return new Date(s).toLocaleTimeString('en-GB',{hour:'2-digit',minute:'2-digit',hour12:false,timeZone:'Europe/London'});}catch{ return ''; } }
  const cls = o => o==='W'?'W':o==='D'?'D':o==='L'?'L':'';

  if (!fx?.matches?.length){
    wrap.innerHTML = `<div style="color:#9aa6b2">⚠ No fixtures data (check /assets/fixtures.json).</div>`;
  } else {
    const t = s => (new Date(s)).getTime();
    const all = fx.matches.slice().sort((a,b)=>t(a.date)-t(b.date));
    const isFin = m => (m.status||"").toUpperCase()==='FINISHED';
    const upcoming = all.filter(m => !isFin(m)).slice(0,8);
    const recent = all.filter(isFin).sort((a,b)=>t(b.date)-t(a.date)).slice(0,8);

    const upHTML = `
      <h3 style="margin:6px 0 8px">Upcoming</h3>
      <table>
        <thead><tr><th>Date (UK)</th><th>Time (UK)</th><th>Comp</th><th>Home</th><th></th><th>Away</th><th>TV</th></tr></thead>
        <tbody>
          ${upcoming.map(m=>`
            <tr>
              <td>${dUK(m.date)}</td><td>${tUK(m.date)}</td>
              <td>${m.comp||''}</td><td>${m.home}</td><td>vs</td><td>${m.away}</td>
              <td>${m.tv||'TBD'}</td>
            </tr>`).join('')}
        </tbody>
      </table>
    `;

    const recHTML = `
      <h3 style="margin:14px 0 6px">Recent Results</h3>
      <table>
        <thead><tr><th>Date</th><th>Comp</th><th>Home</th><th></th><th>Away</th><th>Score</th><th>Highlights</th></tr></thead>
        <tbody>
          ${recent.map(m=>{
            const sc = m.score ? `${m.score.home}–${m.score.away}` : '';
            const oc = m.score?.outcome || '';
            const year = new Date(m.date).getFullYear();
            const q = encodeURIComponent(`${m.home} ${m.away} highlights ${year}`);
            const sky = `https://www.skysports.com/search?q=${q}`;
            const yt  = `https://www.youtube.com/results?search_query=${q}`;
            return `
              <tr class="${cls(oc)}">
                <td>${dUK(m.date)}</td>
                <td>${m.comp||''}</td>
                <td>${m.home}</td><td>vs</td><td>${m.away}</td>
                <td><strong>${sc}</strong>${oc?` (${oc})`:""}</td>
                <td><a class="btn" href="${sky}" target="_blank" rel="noopener">Sky</a>
                    <a class="btn" href="${yt}" target="_blank" rel="noopener" style="margin-left:6px">YT</a></td>
              </tr>`;
          }).join('')}
        </tbody>
      </table>
    `;
    wrap.innerHTML = upHTML + recHTML;
  }
})();
</script>
</body>
</html>
