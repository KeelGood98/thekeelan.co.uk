<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>thekeelan.co.uk</title>
<style>
  :root{
    --bg:#0f0f12;
    --panel:#17181d;
    --text:#e7e8ec;
    --muted:#9aa0a6;
    --accent:#c22d2d;   /* red dot */
    --pill:#2b2f3a;
    --win:#2bbf6a;
    --draw:#e3b341;
    --loss:#ff5d5d;
    --row:#1b1c22;
    --row2:#17181d;
    --line:#262833;
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;background:var(--bg);color:var(--text);font:14px/1.45 system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Ubuntu,"Helvetica Neue",Arial,"Noto Sans","Apple Color Emoji","Segoe UI Emoji";}
  a{color:inherit;text-decoration:none}
  .wrap{
    max-width:1400px;
    margin:24px auto;
    padding:0 16px;
    display:grid;
    grid-template-columns: 220px 1fr 420px;
    grid-gap:18px;
  }
  .card{
    background:var(--panel);
    border-radius:14px;
    box-shadow:0 8px 20px rgba(0,0,0,.35), inset 0 0 0 1px rgba(255,255,255,.03);
    overflow:hidden;
  }
  .pad{padding:14px 16px}
  .title{
    display:flex;align-items:center;gap:8px;
    font-weight:700;
    letter-spacing:.2px;
  }
  .dot{width:8px;height:8px;border-radius:50%;background:var(--accent);display:inline-block}
  /* left column gif */
  .gifbox{display:flex;flex-direction:column;gap:16px}
  .gifbox img{width:100%;display:block;border-radius:12px}
  /* table card */
  .table{
    display:grid;
    grid-template-rows: auto 1fr;
    min-height:420px;
  }
  .tbl-head, .tbl-row{
    display:grid;
    grid-template-columns: 40px 1fr repeat(6,56px);
    column-gap:12px;
    align-items:center;
    padding:10px 14px;
  }
  .tbl-head{
    position:sticky;top:0;background:linear-gradient(var(--panel),var(--panel));
    border-bottom:1px solid var(--line);
    font-weight:600;color:#cfd2da;
  }
  .tbl-body{max-height:520px;overflow:auto}
  .tbl-row{border-bottom:1px solid rgba(255,255,255,.03);background:var(--row)}
  .tbl-row:nth-child(even){background:var(--row2)}
  .num{ text-align:center; font-variant-numeric:tabular-nums; }
  .club{display:flex;align-items:center;gap:10px}
  .club img{width:18px;height:18px;object-fit:contain;filter:drop-shadow(0 1px 1px #0008)}
  /* fixtures */
  .section h3{margin:0 0 6px 0;font-size:15px;color:#cfd2da}
  .fx-list{display:flex;flex-direction:column;gap:10px}
  .fx{
    display:grid;
    grid-template-columns: 44px 1fr auto;
    gap:10px; align-items:center;
    padding:10px 12px; border-radius:10px;
    background:var(--row);
    border:1px solid rgba(255,255,255,.04);
  }
  .date{color:var(--muted);text-align:center;line-height:1.25}
  .date .dow{font-weight:600;color:#cfd2da}
  .match{display:flex;align-items:center;gap:10px}
  .match .side{display:flex;align-items:center;gap:8px;min-width:120px}
  .match img{width:18px;height:18px;object-fit:contain}
  .pill{
    padding:4px 8px;border-radius:999px;
    font-size:12px;letter-spacing:.3px;
    background:var(--pill);color:#cfd2da;
    text-transform:uppercase;font-weight:700
  }
  .score{font-weight:800}
  .win{color:var(--win)} .draw{color:var(--draw)} .loss{color:var(--loss)}
  .muted{color:var(--muted)}
  .sp{opacity:.6}
  /* right column sections */
  .rightcol{display:flex;flex-direction:column;gap:18px}
  @media (max-width:1100px){
    .wrap{grid-template-columns: 1fr}
    .gifbox{order:3}
  }
</style>
</head>
<body>
<div class="wrap">

  <!-- LEFT: gif -->
  <div class="gifbox">
    <div class="card pad">
      <img src="https://media4.giphy.com/media/v1.Y2lkPTc5MGI3NjExNWZpb3poZnFpdWpxeWlybHRsb3M1aTVzeGNjMHFldWR1Nm9jczlpMCZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/8fxad4tvqIzwk/giphy.gif" alt="funny gif">
    </div>
  </div>

  <!-- MIDDLE: table -->
  <div class="card table">
    <div class="pad title"><span class="dot"></span> Premier League Table</div>
    <div class="tbl-head">
      <div class="num">#</div><div>Club</div>
      <div class="num">P</div><div class="num">W</div><div class="num">D</div><div class="num">L</div><div class="num">GD</div><div class="num">Pts</div>
    </div>
    <div id="tableBody" class="tbl-body"></div>
  </div>

  <!-- RIGHT: fixtures -->
  <div class="rightcol">
    <div class="card pad section">
      <div class="title"><span class="dot"></span> Man United — Fixtures & Results</div>
      <h3>Upcoming</h3>
      <div id="upcoming" class="fx-list"></div>
      <h3 style="margin-top:10px">Recent Results</h3>
      <div id="recent" class="fx-list"></div>
    </div>
  </div>

</div>

<script>
const TEAM_ID = 360; // Man United on ESPN
const SCHED_URL = "https://site.api.espn.com/apis/site/v2/sports/soccer/eng.1/teams/" + TEAM_ID + "/schedule";
const TABLE_URL = "https://site.api.espn.com/apis/site/v2/sports/soccer/eng.1/standings";

const q = sel => document.querySelector(sel);
const fmtDay  = (iso)=> new Date(iso).toLocaleDateString("en-GB",{weekday:"short"});
const fmtDate = (iso)=> new Date(iso).toLocaleDateString("en-GB",{day:"2-digit",month:"short"});
const fmtTime = (iso)=> new Date(iso).toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"});

function side(team){
  const name = team?.displayName || team?.name || "";
  const logo = (team?.logo) || (team?.logos?.[0]?.href) || "";
  return {name,logo};
}

function buildFixture(ev){
  const comp = ev?.competitions?.[0] || {};
  // filter EPL only – comp.name or league.name contains 'Premier League'
  const leagueName = (comp?.name || ev?.league?.name || "").toLowerCase();
  if(!leagueName.includes("premier league")) return null;

  const when = ev?.date || comp?.date;
  const home = (comp?.competitors||[]).find(t=>t.homeAway==="home");
  const away = (comp?.competitors||[]).find(t=>t.homeAway==="away");
  if(!home || !away) return null;

  const hs = Number(home?.score||0), as = Number(away?.score||0);
  const st = (comp?.status?.type?.state || ev?.status?.type?.state || "pre").toLowerCase();
  const completed = !!(comp?.status?.type?.completed || ev?.status?.type?.completed);

  const h = side(home.team), a = side(away.team);

  let badgeClass = "", scoreTxt = "", pill = "";
  if(completed){
    scoreTxt = `${hs}–${as}`;
    const isHome = (h.name||"").toLowerCase().startsWith("man");
    const we = isHome ? hs : as, they = isHome ? as : hs;
    badgeClass = (we>they) ? "win" : (we<they) ? "loss" : "draw";
  }else{
    pill = `<span class="pill">UPCOMING</span>`;
  }

  return {
    dateText: `${fmtDay(when)}<br><span class="muted">${fmtDate(when)} ${fmtTime(when)}</span>`,
    left: `<div class="side"><img src="${h.logo}" alt=""><span>${h.name}</span></div>`,
    right:`<div class="side"><img src="${a.logo}" alt=""><span>${a.name}</span></div>`,
    center: pill || `<span class="score ${badgeClass}">${scoreTxt}</span>`,
    isUpcoming: !completed,
    sortKey: new Date(when).getTime()
  };
}

function renderFixtures(list, into){
  into.innerHTML = list.map(f => `
    <div class="fx">
      <div class="date"><div class="dow">${f.dateText}</div></div>
      <div class="match">${f.left}<span class="sp">vs</span>${f.right}</div>
      <div>${f.center}</div>
    </div>`).join("") || `<div class="muted">No items.</div>`;
}

async function loadFixtures(){
  const r = await fetch(SCHED_URL, {cache:"no-store"});
  const data = await r.json();

  const events = [...(data.events||[]), ...(data.nextEvents||[])];
  const items = [];
  for(const ev of events){
    const f = buildFixture(ev);
    if(f) items.push(f);
  }
  items.sort((a,b)=>a.sortKey-b.sortKey);

  const now = Date.now();
  const upcoming = items.filter(x=>x.isUpcoming && x.sortKey>=now).slice(0,8);
  const recent   = items.filter(x=>!x.isUpcoming || x.sortKey<now).slice(-8).reverse();

  renderFixtures(upcoming, q("#upcoming"));
  renderFixtures(recent,   q("#recent"));
}

function getStat(stats, name, def=0){
  const s = stats.find(x=>x.name===name);
  const v = (s && (s.value ?? s.displayValue)) ?? def;
  const n = Number(v);
  return Number.isFinite(n) ? n : def;
}

async function loadTable(){
  const r = await fetch(TABLE_URL, {cache:"no-store"});
  const data = await r.json();

  // ESPN’s blob is nested; find `standings.entries`
  let entries = null;
  (function find(x){
    if(entries) return;
    if(Array.isArray(x)) x.forEach(find);
    else if(x && typeof x==="object"){
      if(x.standings && Array.isArray(x.standings?.entries)){
        entries = x.standings.entries;
      }
      Object.values(x).forEach(find);
    }
  })(data);

  const rows = (entries||[]).map((e,i)=>{
    const t = e.team || {};
    const logo = t.logo || t.logos?.[0]?.href || "";
    const name = t.displayName || t.name || "";
    const s = e.stats || [];
    const played = getStat(s,"gamesPlayed");
    const win    = getStat(s,"wins");
    const draw   = getStat(s,"ties");
    const loss   = getStat(s,"losses");
    const gf     = getStat(s,"goalsFor") || getStat(s,"pointsFor");
    const ga     = getStat(s,"goalsAgainst") || getStat(s,"pointsAgainst");
    const gd     = gf - ga;
    const pts    = getStat(s,"points");
    return {rank:i+1, logo, name, played, win, draw, loss, gd, pts};
  }).filter(r=>r.name).slice(0,20);

  const tbody = q("#tableBody");
  tbody.innerHTML = rows.map(r => `
    <div class="tbl-row">
      <div class="num">${r.rank}</div>
      <div class="club"><img src="${r.logo}" alt=""><span>${r.name}</span></div>
      <div class="num">${r.played}</div>
      <div class="num">${r.win}</div>
      <div class="num">${r.draw}</div>
      <div class="num">${r.loss}</div>
      <div class="num">${r.gd}</div>
      <div class="num">${r.pts}</div>
    </div>
  `).join("") || `<div class="pad muted">No table data available right now.</div>`;
}

(async function init(){
  try{ await loadFixtures(); }catch(e){ console.error(e); q("#upcoming").innerHTML='<div class="muted">Couldn’t load fixtures.</div>'; }
  try{ await loadTable();    }catch(e){ console.error(e); q("#tableBody").innerHTML='<div class="pad muted">No table data available right now.</div>'; }
})();
</script>
</body>
</html>
