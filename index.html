<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>thekeelan.co.uk</title>
<link rel="icon" type="image/svg+xml" href="/assets/favicon.svg" />
<meta name="theme-color" content="#0b0f14" />
<style>
  :root{
    --text:#e9eef5; --muted:#9aa6b2; --card:#12161b; --border:#1e242c; --accent:#6ee7ff; --accent2:#a78bfa; --hdr:72px;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; color:var(--text); font:14px/1.55 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial;
    background:
      linear-gradient(180deg, rgba(0,0,0,0.60), rgba(0,0,0,0.80)),
      url('https://images.unsplash.com/photo-1517927033932-b3d18e61fb3a?auto=format&fit=crop&w=2400&q=60') center top / cover no-repeat fixed;
    background-color:#0b0f14;
  }

  /* Header */
  .site-header{
    position:sticky; top:0; z-index:50;
    display:flex; align-items:center; gap:12px; padding:10px 18px;
    backdrop-filter: blur(8px);
    background: rgba(11,15,20,0.6);
    border-bottom:1px solid var(--border);
  }
  .brand{display:flex;gap:10px;align-items:center}
  .brand-logo{width:28px;height:28px;border-radius:6px;background:
    radial-gradient(circle at 30% 30%,#6ee7ff,transparent 40%),
    radial-gradient(circle at 70% 70%,#a78bfa,transparent 40%); box-shadow:0 0 0 1px #2a3340 inset}
  .brand h1{margin:0;font-size:18px}
  .spacer{flex:1}
  #lastUpdated{white-space:nowrap}
  .nav{display:flex; gap:10px}
  .nav a{ padding:6px 10px; border:1px solid var(--border); border-radius:999px; color:var(--muted); text-decoration:none }
  .nav a:hover{ color:var(--text); border-color:#2a3340; background:#0f141a; }
  .nav a.active{ color:var(--text); border-color:transparent; background: linear-gradient(90deg, rgba(110,231,255,.20), rgba(167,139,250,.20)); box-shadow:0 0 0 1px rgba(110,231,255,.25) inset }

  /* Layout */
  .grid{ display:grid; grid-template-columns:1fr 1.6fr 1.2fr; gap:18px; padding:12px 18px 24px; align-items:start }
  @media (max-width:1200px){ .grid{grid-template-columns:1fr 1fr} }
  @media (max-width:980px){ .grid{grid-template-columns:1fr} }

  .card{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:14px;box-shadow:0 6px 24px rgba(0,0,0,.35)}
  .card h2{margin:0 0 8px}
  .muted{color:var(--muted)}
  .stretch{display:flex;flex-direction:column;height:calc(100dvh - var(--hdr) - 24px);min-height:420px}
  .panel{border:1px solid var(--border);border-radius:10px;overflow:auto;flex:1;min-height:0}
  iframe{width:100%;border:0;border-radius:10px}

  /* Tables */
  table{width:100%;border-collapse:collapse}
  th,td{padding:8px 10px;border-bottom:1px solid var(--border);text-align:center}
  thead th{position:sticky;top:0;background:#0f141a;z-index:1}
  tr:hover td{background:#0f141a}
  .team-cell{display:flex;align-items:center;justify-content:center;gap:8px}
  .badge{width:20px;height:20px;border-radius:50%;display:inline-flex;align-items:center;justify-content:center;background:#0f141a;font-weight:700;font-size:11px;letter-spacing:.5px}
  .badge.img{background:none}
  .badge.initials{background: radial-gradient(closest-side, #1a2430, #0f141a); border:1px solid #243041; color:#b6c2cf; text-transform:uppercase}
  .W{background:#10361f} .D{background:#2b2b17} .L{background:#3a1a1a}

  /* Spotify block (optional) */
  .spotify{margin-top:12px}
</style>
</head>
<body>
<header id="siteHeader" class="site-header">
  <div class="brand">
    <div class="brand-logo" aria-hidden="true"></div>
    <h1>thekeelan.co.uk</h1>
  </div>
  <div class="spacer"></div>
  <div class="muted" id="lastUpdated">Last updated: —</div>
  <nav class="nav">
    <a href="/" class="active">Football</a>
    <a href="/extras.html">Extras</a>
  </nav>
</header>

<div class="grid">
  <!-- LEFT -->
  <section class="card stretch">
    <h2>Left Panel</h2>
    <div class="panel" style="overflow:hidden">
      <img src="https://media3.giphy.com/media/v1.Y2lkPTc5MGI3NjExcThlOWlqcmc5YnZmcTVtaDByZHdpZHd4cWo4YTl0NXB4NGlxNnFlaSZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/yRl0DstAx4nN0RjDLV/giphy.gif"
           alt="gif" style="display:block;width:100%;height:auto" />
    </div>

    <!-- Your playlist -->
    <div class="spotify">
      <iframe style="border-radius:12px" src="https://open.spotify.com/embed/playlist/2Ap76LC4PX2HUyTW2VXe9u?utm_source=generator"
              height="152" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy"></iframe>
    </div>
  </section>

  <!-- CENTRE -->
  <section class="card" style="align-self:start;height:max-content;">
    <h2>Premier League Table</h2>
    <div style="border:1px solid var(--border);border-radius:10px;overflow:auto;">
      <table>
        <thead>
          <tr><th>#</th><th>Team</th><th>P</th><th>W</th><th>D</th><th>L</th><th>GF</th><th>GA</th><th>GD</th><th>Pts</th></tr>
        </thead>
        <tbody id="tableBody"><tr><td colspan="10" class="muted">Waiting for data…</td></tr></tbody>
      </table>
    </div>
  </section>

  <!-- RIGHT -->
  <section class="card stretch">
    <h2>Man United – Fixtures & Results</h2>
    <div id="fixturesWrap" class="panel" style="padding:8px;">
      <div class="muted">Waiting for data…</div>
    </div>
  </section>
</div>

<script>
function setHeaderVar(){
  const h = document.getElementById('siteHeader')?.getBoundingClientRect().height || 72;
  document.documentElement.style.setProperty('--hdr', h+'px');
}
setHeaderVar(); addEventListener('resize', setHeaderVar);

(async () => {
  const bust = `?t=${Date.now()}`;
  const pick = async (paths, asText=false) => {
    for (const p of paths) {
      try {
        const r = await fetch(p + bust, {cache:'no-store'}); 
        if (r.ok) return asText ? r.text() : r.json();
      } catch {}
    }
    return asText ? "" : null;
  };

  // last updated
  const updated = await pick(["/assets/update_stamp.txt","assets/update_stamp.txt"], true);
  if (updated) document.getElementById("lastUpdated").textContent = "Last updated: " + updated.trim();

  // helpers
  const norm = s => (s||"").toLowerCase().replace(/&/g,"and").replace(/[^a-z0-9]/g,"");
  const initials = t => (t||"").split(/\s+/).filter(Boolean).map(w=>w[0]).slice(0,2).join('').toUpperCase();
  const toHttps = u => (u||"").replace(/^http:\/\//i, "https://");

  // load data
  const [table, badgesFile, fixtures] = await Promise.all([
    pick(["/assets/table.json","assets/table.json"]),
    pick(["/assets/badges.json","assets/badges.json"]),
    pick(["/assets/fixtures.json","assets/fixtures.json"])
  ]);

  /* === TABLE === */
  const tbody = document.getElementById("tableBody");
  const localBadges = {};
  if (badgesFile?.badges) for (const [k,v] of Object.entries(badgesFile.badges)) localBadges[norm(k)] = toHttps(v||"");

  function rowHTML(r){
    const logo = toHttps(r.logo || localBadges[norm(r.team)] || "");
    const badge = logo
      ? `<img class="badge img" referrerpolicy="no-referrer" src="${logo}" alt="">`
      : `<span class="badge initials" data-team="${r.team}">${initials(r.team||'')}</span>`;
    return `
      <tr>
        <td>${r.pos ?? ""}</td>
        <td><span class="team-cell">${badge}${r.team ?? ""}</span></td>
        <td>${r.played ?? ""}</td><td>${r.won ?? ""}</td><td>${r.drawn ?? ""}</td><td>${r.lost ?? ""}</td>
        <td>${r.gf ?? ""}</td><td>${r.ga ?? ""}</td><td>${r.gd ?? ""}</td><td><strong>${r.pts ?? ""}</strong></td>
      </tr>`;
  }

  if (!table?.standings?.length) {
    tbody.innerHTML = '<tr><td colspan="10" class="muted">⚠️ No table data (check /assets/table.json).</td></tr>';
  } else {
    tbody.innerHTML = table.standings.map(rowHTML).join("");
  }

  /* === FIXTURES === */
  const wrap = document.getElementById("fixturesWrap");
  if (!fixtures?.matches?.length) {
    wrap.innerHTML = '<div class="muted">⚠️ No fixtures data (check /assets/fixtures.json).</div>';
  } else {
    const t = s => new Date(s).getTime() || 0;
    const isFinished = m => {
      if (m?.score?.home != null && m?.score?.away != null) return true;
      const st = (m.status || "").toLowerCase();
      return st === "post" || t(m.date) < Date.now() - 2*60*60*1000;
    };
    const cls = o => o === "W" ? "W" : o === "D" ? "D" : o === "L" ? "L" : "";

    const all = fixtures.matches.slice().sort((a,b)=> t(a.date) - t(b.date));
    const upcoming = all.filter(m => !isFinished(m)).slice(0, 8);
    const recent   = all.filter(isFinished).sort((a,b)=> t(b.date) - t(a.date)).slice(0, 8);

    const fmtD = d => new Date(d).toLocaleDateString('en-GB',{day:'2-digit',month:'short',year:'numeric', timeZone:'Europe/London'});
    const fmtT = d => new Date(d).toLocaleTimeString('en-GB',{hour:'2-digit',minute:'2-digit', hour12:false, timeZone:'Europe/London'});

    const upHTML = `
      <h3 style="margin:8px 0;">Upcoming</h3>
      <table>
        <thead><tr><th>Date (UK)</th><th>Time (UK)</th><th>Comp</th><th>Home</th><th></th><th>Away</th><th>TV</th></tr></thead>
        <tbody>
          ${upcoming.map(m => `
            <tr>
              <td>${fmtD(m.date)}</td><td>${fmtT(m.date)}</td>
              <td>${m.comp||""}</td><td>${m.home}</td><td>vs</td><td>${m.away}</td>
              <td>${m.tv||"TBD"}</td>
            </tr>`).join("")}
        </tbody>
      </table>`;

    const recHTML = `
      <h3 style="margin:12px 0 6px;">Recent Results</h3>
      <table>
        <thead><tr><th>Date</th><th>Comp</th><th>Home</th><th></th><th>Away</th><th>Score</th><th>Highlights</th></tr></thead>
        <tbody>
          ${recent.map(m=>{
            const sc = (m.score && m.score.home!=null && m.score.away!=null) ? `${m.score.home}–${m.score.away}` : "";
            const oc = m.score?.outcome || "";
            const year = new Date(m.date).getFullYear();
            const q = encodeURIComponent(`${m.home} ${m.away} highlights ${year}`);
            const sky = `https://www.skysports.com/search?q=${q}`;
            const yt  = `https://www.youtube.com/results?search_query=${q}`;
            return `
              <tr class="${cls(oc)}">
                <td>${fmtD(m.date)}</td>
                <td>${m.comp||""}</td>
                <td>${m.home}</td><td>vs</td><td>${m.away}</td>
                <td><strong>${sc}</strong>${oc?` (${oc})`:""}</td>
                <td><a class="btn" href="${sky}" target="_blank" rel="noopener">Sky</a>
                    <a class="btn" href="${yt}" target="_blank" rel="noopener" style="margin-left:6px;">YT</a></td>
              </tr>`;
          }).join("")}
        </tbody>
      </table>`;
    wrap.innerHTML = upHTML + recHTML;
  }
})();
</script>
</body>
</html>
