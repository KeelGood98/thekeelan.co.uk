<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>thekeelan.co.uk</title>
  <style>
    :root{
      --bg:#0b0f0b; --card:#12161b; --muted:#96a0ad; --text:#e9eef5; --accent:#6ee7ff; --border:#1e242c;
      --line:#0f2b12; --pitch:#0d2010;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    /* Football pitch background (subtle) */
    body{
      margin:0; color:var(--text);
      background:
        linear-gradient(180deg, rgba(0,0,0,.35), rgba(0,0,0,.35)),
        repeating-linear-gradient(0deg, var(--pitch) 0 48px, #0b1a0d 48px 96px),
        repeating-linear-gradient(90deg, transparent 0 96px, rgba(255,255,255,0.03) 96px 97px);
      background-color:#0b120d;
      font:14px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial;
    }
    a{color:var(--accent);text-decoration:none}
    header{display:flex;align-items:center;justify-content:space-between;padding:14px 18px}
    .brand{display:flex;gap:10px;align-items:center}
    .brand-logo{width:28px;height:28px;border-radius:6px;background:
      radial-gradient(circle at 30% 30%,#6ee7ff,transparent 40%),
      radial-gradient(circle at 70% 70%,#a78bfa,transparent 40%); box-shadow:0 0 0 1px #2a3340 inset}
    .grid{display:grid;grid-template-columns:1fr 1.4fr 1.4fr;gap:18px;align-items:start;padding:0 18px 24px}
    .card{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:14px;box-shadow:0 6px 24px rgba(0,0,0,.25)}
    .card h2{margin:0 0 8px}
    .muted{color:var(--muted)}
    .table-wrap{border-radius:10px;border:1px solid var(--border);overflow:auto;max-height:none}
    @media (max-width: 980px){ .grid{grid-template-columns:1fr} .table-wrap{max-height:70vh} }
    table{width:100%;border-collapse:collapse}
    th,td{padding:8px 10px;border-bottom:1px solid var(--border);text-align:center}
    thead th{position:sticky;top:0;background:#0f141a;z-index:1}
    tr:hover td{background:#0f141a}
    .team-cell{display:flex;align-items:center;justify-content:center;gap:8px}
    .badge{width:20px;height:20px;border-radius:50%}
    .W{background:#10361f} .D{background:#2b2b17} .L{background:#3a1a1a}
    iframe{width:100%;min-height:520px;border:0;border-radius:10px}
  </style>
</head>
<body>
  <header>
    <div class="brand">
      <div class="brand-logo" aria-hidden="true"></div>
      <h1 style="margin:0;font-size:18px;">thekeelan.co.uk</h1>
    </div>
    <div class="muted" id="lastUpdated">Last updated: —</div>
  </header>

  <div class="grid">
    <!-- LEFT -->
    <section class="card">
      <h2>Left Panel</h2>
      <img src="https://media3.giphy.com/media/v1.Y2lkPTc5MGI3NjExcThlOWlqcmc5YnZmcTVtaDByZHdpZHd4cWo4YTl0NXB4NGlxNnFlaSZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/yRl0DstAx4nN0RjDLV/giphy.gif"
           alt="gif" style="max-width:100%; border-radius:8px;" />
    </section>

    <!-- CENTER: Table -->
    <section class="card">
      <h2>Premier League Table</h2>
      <div class="table-wrap">
        <table>
          <thead>
            <tr><th>#</th><th>Team</th><th>P</th><th>W</th><th>D</th><th>L</th><th>GF</th><th>GA</th><th>GD</th><th>Pts</th></tr>
          </thead>
          <tbody id="tableBody">
            <tr><td colspan="10" class="muted">Waiting for data…</td></tr>
          </tbody>
        </table>
      </div>
    </section>

    <!-- RIGHT: MUFC + R6 -->
    <section class="card">
      <h2>Man United – Fixtures & Results</h2>
      <div id="fixturesWrap" class="table-wrap" style="padding:8px;">
        <div class="muted">Waiting for data…</div>
      </div>
      <div class="card" style="margin-top:12px;">
        <h2>R6 Tracker</h2>
        <iframe id="r6Frame" title="R6 Tracker"></iframe>
      </div>
    </section>
  </div>

  <script>
  (async () => {
    const bust = `?t=${Date.now()}`;

    const log = (...a) => console.log("[keelan]", ...a);
    const err = (...a) => console.error("[keelan]", ...a);

    function showError(where, msg) {
      const el = document.getElementById(where);
      if (!el) return;
      el.innerHTML = `<tr><td colspan="10"><div class="muted">⚠️ ${msg}</div></td></tr>`;
    }

    // Try multiple path variants for safety
    async function getJSONMulti(relPath) {
      const candidates = [`/assets/${relPath}`, `assets/${relPath}`, `./assets/${relPath}`];
      for (const url of candidates) {
        try {
          log("Fetching", url + bust);
          const r = await fetch(url + bust, { cache: "no-store" });
          log("Response", url, r.status);
          if (!r.ok) continue;
          const data = await r.json();
          const size = Array.isArray(data) ? data.length : (data ? Object.keys(data).length : 0);
          if (size > 0) return data;
        } catch (e) { err("Fetch failed", url, e); }
      }
      return null;
    }

    function renderTableRows(rows) {
      return rows.map(r => `
        <tr>
          <td>${r.pos ?? ""}</td>
          <td><span class="team-cell">
            ${r.badge ? `<img class="badge" src="${r.badge}" alt="">` : ""}${r.team ?? ""}
          </span></td>
          <td>${r.played ?? ""}</td><td>${r.won ?? ""}</td><td>${r.drawn ?? ""}</td><td>${r.lost ?? ""}</td>
          <td>${r.gf ?? ""}</td><td>${r.ga ?? ""}</td><td>${r.gd ?? ""}</td><td><strong>${r.pts ?? ""}</strong></td>
        </tr>
      `).join("");
    }

    // ===== TABLE =====
    const table = await getJSONMulti("table.json");
    if (!table || !Array.isArray(table.standings) || table.standings.length === 0) {
      showError("tableBody", "No table data (check /assets/table.json).");
    } else {
      document.getElementById("tableBody").innerHTML = renderTableRows(table.standings);
      const lu = document.getElementById("lastUpdated");
      if (lu) lu.textContent = "Last updated: " + new Date(table.updated || Date.now()).toLocaleString();
    }

    // ===== FIXTURES =====
    const fixtures = await getJSONMulti("fixtures.json");
    const wrap = document.getElementById("fixturesWrap");
    if (!fixtures || !Array.isArray(fixtures.matches)) {
      wrap.innerHTML = '<div class="muted">⚠️ No fixtures data (check /assets/fixtures.json).</div>';
    } else {
      const now = Date.now();
      const parse = d => new Date(d).getTime() || 0;

      // Guard against any bad statuses: compute finished by score if present, else by date < now
      const isFinished = m => {
        if (m.score && (typeof m.score.home === "number") && (typeof m.score.away === "number")) return true;
        return parse(m.date) < now;
      };
      const outcomeClass = o => o === "W" ? "W" : o === "D" ? "D" : o === "L" ? "L" : "";

      const all = fixtures.matches.slice().sort((a,b)=> parse(a.date) - parse(b.date));
      const upcoming = all.filter(m => !isFinished(m)).slice(0, 8);
      const recent = all.filter(isFinished).sort((a,b)=> parse(b.date) - parse(a.date)).slice(0, 8);

      const fmtDT = d => new Date(d).toLocaleString([], { dateStyle:"medium", timeStyle:"short" });

      const upHTML = upcoming.length ? `
        <h3 style="margin:8px 0;">Upcoming</h3>
        <table><thead><tr><th>Date</th><th>Comp</th><th>Home</th><th></th><th>Away</th></tr></thead>
        <tbody>
          ${upcoming.map(m =>
            `<tr><td>${fmtDT(m.date)}</td><td>${m.comp||""}</td><td>${m.home}</td><td>vs</td><td>${m.away}</td></tr>`
          ).join("")}
        </tbody></table>
      ` : '<div class="muted">No upcoming fixtures.</div>';

      const recHTML = recent.length ? `
        <h3 style="margin:12px 0 6px;">Recent Results</h3>
        <table><thead><tr><th>Date</th><th>Comp</th><th>Home</th><th></th><th>Away</th><th>Score</th></tr></thead>
        <tbody>
          ${recent.map(m => {
            const sc = m.score ? `${m.score.home}–${m.score.away}` : "";
            const oc = m.score?.outcome || "";
            return `<tr class="${outcomeClass(oc)}">
              <td>${new Date(m.date).toLocaleDateString()}</td>
              <td>${m.comp||""}</td>
              <td>${m.home}</td><td>vs</td><td>${m.away}</td>
              <td><strong>${sc}</strong>${oc?` (${oc})`:""}</td>
            </tr>`;
          }).join("")}
        </tbody></table>
      ` : "";

      wrap.innerHTML = upHTML + recHTML;
    }

    // R6
    const f = document.getElementById("r6Frame");
    if (f && !f.src) f.src = "https://r6.tracker.network/profile/pc/BambyOnSpice?embed=1";
  })();
  </script>
</body>
</html>
