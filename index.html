<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Your Mum</title>

  <style>
    :root{
      --bg:#0c0f13; --card:#151a22; --muted:#8993a1; --text:#e8edf4; --accent:#3ba1ff;
      --ok:#1fbf75; --bad:#f55454; --draw:#c1c7d0; --stroke:rgba(255,255,255,.08);
    }
    *{box-sizing:border-box}
    html,body{margin:0;height:100%;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,"Helvetica Neue",Arial,"Noto Sans",sans-serif}
    a{color:inherit;text-decoration:none}
    .wrap{max-width:1300px;margin:0 auto;padding:18px}
    header{display:flex;align-items:center;gap:12px;justify-content:space-between;margin-bottom:14px}
    .brand{display:flex;align-items:center;gap:10px;font-weight:700}
    .dot{width:10px;height:10px;border-radius:50%;background:var(--accent);display:inline-block;box-shadow:0 0 16px var(--accent)}
    nav{display:flex;gap:8px}
    nav a{padding:8px 12px;border:1px solid var(--stroke);border-radius:999px;color:var(--text);opacity:.9}
    nav a.active{background:var(--accent);border-color:transparent;color:#051320;font-weight:600}
    .grid{display:grid;grid-template-columns:360px 1fr 460px;gap:18px}
    .card{background:var(--card);border:1px solid var(--stroke);border-radius:14px;box-shadow:0 10px 30px rgba(0,0,0,.25)}
    .card h2{margin:0;padding:14px 16px;border-bottom:1px solid var(--stroke);font-size:20px}
    .card-body{padding:14px 16px}
    .gif{width:100%;border-bottom-left-radius:14px;border-bottom-right-radius:14px;display:block}

    /* TABLE */
    table{width:100%;border-collapse:collapse}
    th,td{padding:10px 8px;text-align:center;font-size:14px}
    th{text-transform:uppercase;letter-spacing:.06em;font-size:12px;color:var(--muted)}
    tbody tr{border-top:1px solid var(--stroke)}
    tbody tr:hover{background:rgba(255,255,255,.03)}
    td.team{text-align:left;display:flex;align-items:center;gap:10px}
    .badge{width:18px;height:18px;border-radius:50%;display:inline-grid;place-items:center;background:#0f1319;border:1px solid var(--stroke);overflow:hidden}
    .badge img{width:100%;height:100%;object-fit:contain}
    .badge span{font-size:10px;color:var(--muted);font-weight:700}

    /* Make the table area scrollable but show ALL 20 rows by default height */
    .table-wrap{max-height:560px;overflow:auto;border-radius:0 0 14px 14px}

    /* FIXTURES */
    .subtle{color:var(--muted);font-size:12px}
    .pill{display:inline-block;padding:2px 8px;border-radius:999px;border:1px solid var(--stroke);font-size:12px;color:var(--muted)}
    .w{color:var(--ok)} .l{color:var(--bad)} .d{color:var(--draw)}
    .twocol{display:grid;grid-template-columns: 1fr auto;gap:12px;align-items:center}
    .fixture-table th, .fixture-table td{padding:8px}
    .fixture-table th{font-size:11px}
    .fixture-table td{font-size:14px}
    .divider{height:1px;background:var(--stroke);margin:10px 0}

    /* R6 embed takes full card height */
    .embed{border:0;width:100%;height:620px;border-bottom-left-radius:14px;border-bottom-right-radius:14px}
    @media (max-width:1200px){
      .grid{grid-template-columns:1fr}
      .embed{height:580px}
    }

    /* background image (football nets vibe) */
    body::after{
      content:"";position:fixed;inset:0;pointer-events:none;
      background:
        radial-gradient(1200px 600px at 60% 85%, rgba(59,161,255,.08), transparent 60%),
        radial-gradient(900px 500px at 20% 10%, rgba(255,255,255,.05), transparent 60%);
      mix-blend-mode:screen;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand"><span class="dot"></span> thekeelan.co.uk</div>
      <nav>
        <a class="active" href="./">Football</a>
        <a href="./extras.html">Extras</a>
      </nav>
    </header>

    <div class="grid">
      <!-- LEFT: GIF + R6 -->
      <div class="card">
        <h2>Left Panel</h2>
        <img class="gif" src="https://media3.giphy.com/media/v1.Y2lkPTc5MGI3NjExcThlOWlqcmc5YnZmcTVtaDByZHdpZHd4cWo4YTl0NXB4NGlxNnFlaSZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/yRl0DstAx4nN0RjDLV/giphy.gif" alt="gif" />
        <div class="card-body">
          <h2 style="margin:-2px 0 8px 0;">R6 Tracker</h2>
          <iframe class="embed" src="https://tracker.gg/r6/profile/ubisoft/BambyOnSpice/overview?embed=true" loading="lazy"></iframe>
        </div>
      </div>

      <!-- MIDDLE: TABLE -->
      <div class="card" id="table-card">
        <h2>Premier League Table</h2>
        <div class="table-wrap">
          <table id="pl-table" aria-label="Premier League Table">
            <thead>
              <tr>
                <th>#</th><th style="text-align:left">Team</th>
                <th>P</th><th>W</th><th>D</th><th>L</th><th>GF</th><th>GA</th><th>GD</th><th>Pts</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>

      <!-- RIGHT: FIXTURES -->
      <div class="card" id="fx-card">
        <h2>Man United – Fixtures &amp; Results</h2>
        <div class="card-body">
          <div class="subtle" id="updatedStamp">Loading…</div>

          <h3 style="margin:14px 0 6px 0;">Upcoming</h3>
          <table class="fixture-table" id="fx-upcoming">
            <thead>
              <tr>
                <th>Date (UK)</th><th>Time (UK)</th><th>Comp</th><th>Home</th><th></th><th>Away</th><th>TV (UK)</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>

          <div class="divider"></div>

          <h3 style="margin:10px 0 6px 0;">Recent Results</h3>
          <table class="fixture-table" id="fx-recent">
            <thead>
              <tr>
                <th>Date</th><th>Comp</th><th>Home</th><th></th><th>Away</th><th>Score</th><th>Highlights</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Small helper for cache-busting
    const bust = () => `?t=${Date.now()}`;

    // Render helpers
    const el = sel => document.querySelector(sel);
    const tbody = sel => el(sel).querySelector("tbody");
    const fmtDate = iso => {
      if(!iso) return "—";
      const d = new Date(iso);
      if (isNaN(d)) return iso;
      return d.toLocaleDateString("en-GB", { day:"2-digit", month:"short", year:"numeric" });
    };
    const fmtTime = iso => {
      if(!iso) return "—";
      const d = new Date(iso);
      if (isNaN(d)) return "—";
      return d.toLocaleTimeString("en-GB", { hour:"2-digit", minute:"2-digit" });
    };

    // Fallback initials avatar when no badge is found
    function initials(name){
      const parts = (name||"").split(/\s+/).filter(Boolean);
      const pick = (s)=>s[0] ? s[0].toUpperCase() : "";
      if (!parts.length) return "FC";
      if (parts.length === 1) return pick(parts[0]);
      return pick(parts[0])+pick(parts[parts.length-1]);
    }

    // ---- TABLE (ALL 20 TEAMS; NO SLICE) ----
    async function renderTable(){
      try{
        const [tableRes, badgesRes] = await Promise.all([
          fetch(`/assets/table.json${bust()}`),
          fetch(`/assets/badges.json${bust()}`)
        ]);
        const table = await tableRes.json();
        const badges = await badgesRes.json().catch(()=> ({}));

        const rows = table.standings || [];    // <-- SHOW ALL 20 ROWS
        const tb = tbody("#pl-table");
        tb.innerHTML = "";

        rows.forEach((r)=>{
          const tr = document.createElement("tr");
          const badgeUrl = badges[r.team] || null;

          tr.innerHTML = `
            <td>${r.pos ?? ""}</td>
            <td class="team">
              <span class="badge">${
                badgeUrl
                  ? `<img src="${badgeUrl}" alt="${r.team} badge"/>`
                  : `<span>${initials(r.team)}</span>`
              }</span>
              <span>${r.team}</span>
            </td>
            <td>${r.played ?? ""}</td>
            <td>${r.won ?? ""}</td>
            <td>${r.drawn ?? ""}</td>
            <td>${r.lost ?? ""}</td>
            <td>${r.gf ?? ""}</td>
            <td>${r.ga ?? ""}</td>
            <td>${r.gd ?? ""}</td>
            <td>${r.pts ?? ""}</td>
          `;
          tb.appendChild(tr);
        });
      }catch(e){
        console.error("table render error", e);
        tbody("#pl-table").innerHTML = `<tr><td colspan="10" class="subtle">Could not load table.</td></tr>`;
      }
    }

    // ---- FIXTURES (filtered to MUFC just in case) ----
    async function renderFixtures(){
      try{
        const res = await fetch(`/assets/fixtures.json${bust()}`);
        const data = await res.json();
        const MU = "Manchester United";
        const all = (data.matches || []).filter(m =>
          (m.home||"").toLowerCase() === MU.toLowerCase() ||
          (m.away||"").toLowerCase() === MU.toLowerCase()
        );

        // stamp
        const up = data.updated ? new Date(data.updated) : null;
        el("#updatedStamp").textContent = up ? `Last updated: ${up.toLocaleString("en-GB")}` : "—";

        const now = Date.now();
        const upcoming = all
          .filter(m => m.status === "SCHEDULED" || !m.score)
          .sort((a,b)=> (new Date(a.date)) - (new Date(b.date)))
          .slice(0, 6);

        const recent = all
          .filter(m => m.status === "FINISHED" && m.score)
          .sort((a,b)=> (new Date(b.date)) - (new Date(a.date)))
          .slice(0, 6);

        const upTB = tbody("#fx-upcoming");
        upTB.innerHTML = "";
        if (upcoming.length === 0){
          upTB.innerHTML = `<tr><td colspan="7" class="subtle">No upcoming fixtures.</td></tr>`;
        } else {
          upcoming.forEach(m=>{
            upTB.insertAdjacentHTML("beforeend", `
              <tr>
                <td>${fmtDate(m.date)}</td>
                <td>${fmtTime(m.date)}</td>
                <td>${m.comp ?? ""}</td>
                <td>${m.home ?? ""}</td>
                <td>vs</td>
                <td>${m.away ?? ""}</td>
                <td>${m.tv || "—"}</td>
              </tr>
            `);
          });
        }

        const rcTB = tbody("#fx-recent");
        rcTB.innerHTML = "";
        if (recent.length === 0){
          rcTB.innerHTML = `<tr><td colspan="7" class="subtle">No recent matches.</td></tr>`;
        } else {
          recent.forEach(m=>{
            const oc = (m.score && m.score.outcome) ? m.score.outcome.toLowerCase() : "";
            const ocLabel = oc ? `<span class="${oc} pill">${oc.toUpperCase()}</span>` : "";
            const scoreTxt = (m.score) ? `${m.score.home}–${m.score.away}` : "—";
            rcTB.insertAdjacentHTML("beforeend", `
              <tr>
                <td>${fmtDate(m.date)}</td>
                <td>${m.comp ?? ""}</td>
                <td>${m.home ?? ""}</td>
                <td>vs</td>
                <td>${m.away ?? ""}</td>
                <td>${scoreTxt} ${ocLabel}</td>
                <td>
                  ${m.highlights?.sky ? `<a class="pill" href="${m.highlights.sky}" target="_blank" rel="noopener">Sky</a>` : ""}
                  ${m.highlights?.yt  ? `<a class="pill" href="${m.highlights.yt}"  target="_blank" rel="noopener">YT</a>`  : ""}
                </td>
              </tr>
            `);
          });
        }
      }catch(e){
        console.error("fixtures render error", e);
        tbody("#fx-upcoming").innerHTML = `<tr><td colspan="7" class="subtle">Could not load fixtures.</td></tr>`;
        tbody("#fx-recent").innerHTML   = `<tr><td colspan="7" class="subtle">—</td></tr>`;
      }
    }

    // Init
    renderTable();
    renderFixtures();
  </script>
</body>
</html>
